Nb=typeof Nb!=="undefined"?Nb:{};Nb.Core={};Nb.Core.Cookie={set:function(b,f,e,d){d=d||"/";var c=b+"="+f+"; path="+d;if(e){var a=new Date();a.setTime(a.getTime()+e*1000);c+="; expires="+a.toGMTString()}document.cookie=c},get:function(a){var b=document.cookie.match("(?:^|;)\\s*"+a+"=([^;]*)");if(b!==null&&b.length>1){return b[1]}else{return null}}};Nb.Core.Util={createInstance:function(a,c){var b=this.getType(a);return new b(c)},createLink:function(a,e){var f=[];for(var c in e){if(e.hasOwnProperty(c)){var d=e[c];if(d instanceof Array){for(var b=0;b<d.length;b++){f.push(c+"[]="+encodeURIComponent(d[b]))}}else{f.push(c+"="+encodeURIComponent(d))}}}return a+"?"+f.join("&")},getQueryString:function(e,d){var f=[];for(var b in e){if(e.hasOwnProperty(b)){var c=e[b];var g=d?d+"["+b+"]":b;if(typeof c=="boolean"){c=c?"1":"0";f.push(g+"="+encodeURIComponent(c))}else{if(c instanceof Array){for(var a=0;a<c.length;a++){if(typeof c[a]!="object"&&c[a]!==null){f.push(g+"[]="+c[a])}else{f.push(this.getQueryString(c[a],g+"["+a+"]"))}}}else{if(typeof c=="object"){f.push(this.getQueryString(c,g))}else{f.push(g+"="+encodeURIComponent(c))}}}}}return f.join("&")},getType:function(a){var c=a.split(".");var d=window;for(var b=0;b<c.length;b++){d=typeof d[c[b]]!="undefined"?d[c[b]]:null;if(d===null){throw new Error("Type '"+a+"' couldn't be found")}}return d},formatString:function(c,b){var a=arguments;return c.replace(/\{(\d+)\}/g,function(d,e){return a[Number(e)+1]})}};Nb=typeof Nb!="undefined"?Nb:{};YUI().use("*",function(a){Nb.Lib=a});(function(){var b=Nb.Lib;var a={37:"left",39:"right",38:"up",40:"down",33:"pageUp",32:"space",34:"pageDown",46:"del",36:"home",35:"end",13:"enter",27:"esc",9:"tab"};Nb.Core.KeyNav=function(c){this.element=c;this.publish("key");this.event=null;this._running=false;this.start()};Nb.Core.KeyNav.prototype={_onKeyDown:function(c){if(!a.hasOwnProperty(c.keyCode)){return}c.keyName=a[c.keyCode];this.fire("key",c)},getCursorPosition:function(){var e=b.Node.getDOMNode(this.element);var c=-1;if(typeof e.selectionStart=="number"){c=e.selectionStart}else{if(document.selection&&e.createTextRange){var g=document.selection;var d=g.createRange();var f=e.createTextRange();f.setEndPoint("EndToStart",d);c=f.text.length}}return c},destroy:function(){this.stop()},start:function(){if(this._running){return}this._running=true;this._event=b.on("keydown",this._onKeyDown,this.element,this)},stop:function(){if(!this._running){return}this._running=false;this._event.detach()}};b.augment(Nb.Core.KeyNav,b.EventTarget)})();Nb.Core.KeyCodes={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229};(function(){var b=Nb.Lib;var a="load";Nb.Core.Component=function(c){Nb.Core.Component.superclass.constructor.apply(this,arguments);this.publish(a,{emitFacade:true})};Nb.Core.Component.NAME="component";Nb.Core.Component.ATTRS={loaded:{value:false,setter:function(c){if(typeof c==="boolean"){this.fire(a);return c}}}};b.extend(Nb.Core.Component,b.Base)}());(function(){var b=Nb.Lib;var a="close";YUI.namespace.call(window,"Nb.Core.UI");Nb.Core.UI.Layer=function(c){Nb.Core.UI.Layer.superclass.constructor.apply(this,arguments);this._headerEl=null;this._contentEl=null;this._buttonsEl=null;this.publish(a,{emitFacade:true})};Nb.Core.UI.Layer.NAME="layer";Nb.Core.UI.Layer.ATTRS={buttons:{value:[],setter:function(e){if(this.get("element")===null){return e}if(this._buttonsEl===null){var c=b.DOM.create('<div class="layer-buttons"></div>');this._buttonsEl=b.one(c);this._contentEl.get("parentNode").appendChild(this._buttonsEl)}b.Event.purgeElement(this._buttonsEl,true);this._buttonsEl.set("innerHTML","");for(var d=0;d<e.length;d++){if(e[d] instanceof Nb.Core.UI.Layer.LayerButton){e[d].render(this._buttonsEl)}else{throw new Error("Nb.Core.UI.Layer.Layer: Layer button is not an instance of Nb.Core.UI.Layer.LayerButon")}}return e}},content:{value:"",getter:function(c){if(this.get("element")===null){return c}return this._contentEl.get("innerHTML")},setter:function(c){if(this.get("element")===null){return c}this._contentEl.set("innerHTML","");this._contentEl.append(c);return c}},header:{value:"",getter:function(c){if(this.get("element")===null){return c}return this._headerEl.get("innerHTML")},setter:function(c){if(this.get("element")===null){return c}this._headerEl.set("innerHTML",c);return c}},element:{value:null,setter:function(c){if(c){c=b.one(c);this._headerEl=c.one(".layer-headline");this._contentEl=c.one(".layer-body-content");c.one(".layer-close").on("click",this._onClose,this);this.dd=new b.DD.Drag({node:c});this.dd.addHandle(".layer-headline")}return c}},width:{value:535,getter:function(d){var c=this.get("element");if(c===null){return d}return parseInt(c.getStyle("width").match(/[0-9]+/)[0],10)},setter:function(d){var c=this.get("element");if(c===null){return d}c.setStyle("width",d+"px");return d}},xy:{setter:function(d){var c=this.get("element");if(c===null){return[0,0]}c.setXY(d);return d}}};b.extend(Nb.Core.UI.Layer,b.Base,{_getZoomLayer:function(){var c=b.one("#zoom-layer");if(c===null){c=document.createElement("div");c.id="zoom-layer";document.body.appendChild(c);c=b.one(c)}return c},_expandFrom:function(f){var c=this._getZoomLayer();f=b.one(f);c.setXY(f.getXY());c.setStyle("visibility","visible");c.setStyle("width",f.get("offsetWidth")+"px");c.setStyle("height",f.get("offsetHeight")+"px");c.setStyle("opacity",0);var d=this.get("element");var e=new b.Anim({node:c,to:{xy:d.getXY(),width:d.get("offsetWidth"),height:d.get("offsetHeight"),opacity:1},duration:0.3,ease:b.Easing.easeOutStrong});e.on("end",this._onExpandComplete,this);e.run()},_onClose:function(c){c.halt();this.fire(a);this.hide()},_onExpandComplete:function(){this._getZoomLayer().setStyle("visibility","hidden");this.get("element").setStyle("visibility","visible")},hide:function(){var c=this.get("element");c.setStyle("visibility","hidden")},getCenterXy:function(){return[Math.max(b.DOM.docScrollX()+(b.DOM.winWidth()-this.get("element").get("offsetWidth"))/2,0),Math.max(b.DOM.docScrollY()+(b.DOM.winHeight()-this.get("element").get("offsetHeight"))/2,0)]},getHtml:function(){return['<div class="layer">','<div class="layer-body-wrapper">','<div class="layer-headline"></div>','<div class="layer-body-content"></div>','<div class="layer-background"></div>',"</div>",'<div class="layer-close"></div>','<div class="layer-east"></div>','<div class="layer-west"></div>','<div class="layer-north-west"></div>','<div class="layer-north">','<div class="layer-north-inner"></div>',"</div>",'<div class="layer-north-east"></div>','<div class="layer-south-west"></div>','<div class="layer-south">','<div class="layer-south-inner"></div>',"</div>",'<div class="layer-south-east"></div>',"</div>"].join("")},isVisible:function(){var c=this.get("element");return(c&&c.getStyle("visibility")!="hidden")},render:function(e){e=b.one(e);if(!e){throw new Error("Nb.Core.UI.Layer: parent element is not specified.")}var c=this.get("element");if(c!==null){return}c=b.DOM.create(this.getHtml());e.append(c);var h=this.get("header");var g=this.get("content");var f=this.get("buttons");var d=this.get("width");this.set("element",c);this.set("header",h);this.set("content",g);this.set("buttons",f);this.set("width",d)},setStatus:function(d,c){if(!this._statusEl){this._statusEl=b.DOM.create('<div class="layer-status"></div>');this.get("element").appendChild(this._statusEl)}this._statusEl.innerHTML=d;if(c){b.DOM.addClass(this._statusEl,"layer-status-loading")}else{b.DOM.removeClass(this._statusEl,"layer-status-loading")}this._statusEl.style.display=d.length>0?"block":"none"},show:function(c){var d=this.get("element");if(d===null){this.render(document.body);d=this.get("element")}c=c||{};if(typeof c.xy=="object"&&c.xy instanceof Array){d.setXY(c.xy)}else{d.setXY(this.getCenterXy())}if(this.isVisible()){return}if(typeof c.from=="object"||typeof c.from=="string"){this._expandFrom(c.from);return}else{this.get("element").setStyle("visibility","visible")}}})})();(function(){var e=Nb.Lib;var d="button-disabled";var g="validateComplete";var c="submit";var b="submitComplete";var a="submitFail";var f="submitError";Nb.Core.Form=function(h){Nb.Core.Form.superclass.constructor.apply(this,arguments);this.on("destroy",this._onDestroy,this);this.publish(c,{emitFacade:true});this.publish(b,{emitFacade:true});this.publish(a,{emitFacade:true});this.publish(f,{emitFacade:true});this.publish(g,{emitFacade:true});this._validationCfg=h.validation;this._initControls(h.controls);this._initButtons(h.buttons)};Nb.Core.Form.NAME="form";Nb.Core.Form.ATTRS={buttons:{value:null},controls:{value:null},errorProvider:{value:null,getter:function(h){return h},setter:function(h){if(h&&!(h instanceof Nb.Core.Form.ErrorProvider)&&h.type){h=Nb.Core.Util.createInstance(h.type,h)}else{if(h&&!(h instanceof Nb.Core.Form.ErrorProvider)){throw new Error("Nb.Core.Form: errorProvider must be an instance of Nb.Core.Form.ErrorProvider")}}return h}},isSubmitting:{value:false},validation:{value:null,getter:function(h){return h},setter:function(h){if(h&&!(h instanceof Nb.Core.Form.FormValidation)&&h.validators){h=new Nb.Core.Form.FormValidation(h)}else{if(h&&!(h instanceof Nb.Core.Form.FormValidation)){throw new Error("Nb.Core.Form: validation must be an instance of Nb.Core.Form.FormValidation")}}return h}}};e.extend(Nb.Core.Form,Nb.Core.Component,{_initButtons:function(k){var l=[],j,h;for(h=0;h<k.length;h++){k[h].form=this;j=Nb.Core.Util.createInstance(k[h].type,k[h]);l.push(j)}this.set("buttons",l)},_initControls:function(h){var j=[],l,k;for(k=0;k<h.length;k++){h[k].container=this;l=Nb.Core.Util.createInstance(h[k].type,h[k]);j.push(l)}this.set("controls",j)},_onDestroy:function(){var h=this.get("controls"),j;for(j=0;j<h.length;j++){h[j].destroy();return}var k=this.get("buttons");for(j=0;j<k.length;j++){k[j].destroy()}},_onSubmitComplete:function(k,i){if(i.status!=200){this.fire(a);return}this.set("isSubmitting",false);var h;try{h=e.JSON.parse(i.responseText)}catch(j){this.fire(a);return}if(h.success){this.fire(b,{response:h})}else{this.fire(f,{response:h});if(this.get("errorProvider")){this.get("errorProvider").show(this,h.errors)}}},_sendData:function(h,i){this.set("isSubmitting",true);e.io(h,{method:"post",data:Nb.Core.Util.getQueryString(i),on:{complete:this._onSubmitComplete},context:this})},getControlByName:function(j){var h=this.get("controls");for(var k=0;k<h.length;k++){if(h[k].get("name")==j){return h[k]}}return null},getData:function(){var h=this.get("controls"),m={},k;for(k=0;k<h.length;k++){var j=h[k].get("name");var l=h[k].get("value");m[j]=l}return m},submit:function(i){if(this.get("isSubmitting")){return}var j=this.getData();var h=this.validate(j);if(!this.fire(g,{result:h})){return}if(!h.isValid){if(!this.get("errorProvider")){throw Error("Nb.Core.Form: ErrorProvider is not specified.")}this.get("errorProvider").show(this,h.errors);return}this.fire(c);this._sendData(i,j)},validate:function(i){i=i||this.getData();var h=this.get("validation");if(!h){return new Nb.Core.Form.FormValidationResult(true,[])}return h.validate(i)}})})();if(typeof Nb.Core.Form==="undefined"){Nb.Core.Form={}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}Nb.Core.Form.FormValidation=function(a,b){var c=Nb.Core.Form.Validator;if(b===undefined){b=[]}if(b.indexOf(c)===-1){b.unshift(c)}this._init(a,b)};Nb.Core.Form.FormValidation.prototype={_getErrors:function(a){var e=[];var c=[];for(var b=0;b<a.length;b++){var d=a[b].fieldName;if(a[b].isValid||c.indexOf(d)!=-1){continue}e.push({fieldName:d,type:a[b].type,message:a[b].errorMessage});c.push(d)}return e},_init:function(b,g){var h=b.validators;var a=[],f,e;for(var d=0;d<h.length;d++){f=h[d].type;for(var c=0;c<g.length;c++){e=g[c][f+"Validator"];if(typeof e=="function"){a.push(new e(f,h[d]));break}}}this._validators=a},getFormVars:function(h){var g;if(typeof h=="string"){g=(document.getElementById(h)||document.forms[h])}else{if(typeof h=="object"){g=h}else{throw"Nb.Core.Form.FormValidation: formId should be a form object or form id"}}var a,f,e,j,d={};var b=new RegExp("[^$]+$","i");for(var c=0;c<g.elements.length;c++){a=g.elements[c];j=g.elements[c].disabled;f=g.elements[c].name;if(b.test(g.elements[c].name)){f=b.exec(g.elements[c].name)[0]}e=g.elements[c].value;if(!j&&f){switch(a.type){case"select-one":case"select-multiple":d[f]=e;break;case"radio":case"checkbox":if(a.checked){d[f]=e}break;case"file":case undefined:case"reset":case"button":break;case"submit":break;default:d[f]=e;break}}}return d},validate:function(e){if(typeof e=="string"||(e.tagName&&e.tagName.toLowerCase()=="form")){e=this.getFormVars(e)}if(typeof e!="object"){throw new TypeError("Nb.Core.Form.FormValidation.validate: wrong data type")}var a={success:false,errors:[]};var b=this._validators;var f=true,d=b.length;for(var c=0;c<d;c++){f=b[c].validate(e[b[c].fieldName],e)&&f}return new Nb.Core.Form.FormValidationResult(f,this._getErrors(b))}};Nb.Core.Form.FormValidationResult=function(a,b){this.isValid=a;this.errors=b};Nb.Core.Form.FormValidationResult.prototype={getErrorTexts:function(){var b=[];for(var a=0;a<this.errors.length;a++){b.push(this.errors[a].message)}return b}};Nb.Core.Form.Validator=function(b,a){this.type=b;this.init(a);this.isValid=false};Nb.Core.Form.Validator.prototype={init:function(a){this.errorMessage=a.errorMessage;this.fieldName=a.fieldName},isEmpty:function(a){if(!a){a=""}else{if(a instanceof Array){return a.length===0}}return a.replace(/[\t\s\n\r]/,"").length===0},validate:function(a,b){throw new Error("Nb.Core.Form.Validator."+this.type+", validate method is not implemented")}};Nb.Core.Form.Validator.object=function(b){var a=function(){};a.prototype=b;return new a()};Nb.Core.Form.Validator._iefix=function(c,b){var a=b.toString;if(typeof a=="function"&&a!=Object.prototype.toString){c.toString=a}};Nb.Core.Form.Validator.extend=function(d,a,f){var c=Nb.Core.Form.Validator;if(!d){throw new Error("extend failed, verify dependencies")}var e=c.prototype,b=this.object(e);d.prototype=b;b.constructor=d;d.superclass=e;if(c!=Object&&e.constructor==Object.prototype.constructor){e.constructor=c}if(a){this.mix(b,a,true)}if(f){this.mix(d,f,true)}return d};Nb.Core.Form.Validator.mix=function(a,m,d,k,h,j){if(!m||!a){return a||{}}if(h){switch(h){case 1:return this.mix(a.prototype,m.prototype,d,k,0,j);case 2:this.mix(a.prototype,m.prototype,d,k,0,j);break;case 3:return this.mix(a,m.prototype,d,k,0,j);case 4:return this.mix(a.prototype,m,d,k,0,j);default:}}var g=j&&a instanceof Array,f,e,b;if(k&&k.length){for(f=0,e=k.length;f<e;++f){b=k[f];if(b in m){if(j&&typeof a[b]=="object"){this.mix(a[b],m[b])}else{if(!g&&(d||!(b in a))){a[b]=m[b]}else{if(g){a.push(m[b])}}}}}}else{for(f in m){if(j&&typeof a[f]=="object"){this.mix(a[f],m[f])}else{if(!g&&(d||!(f in a))){a[f]=m[f]}else{if(g){a.push(m[f])}}}}var c=navigator.userAgent.match(/MSIE/);if(c){this._iefix(a,m)}}return a};Nb.Core.Form.Validator.RequiredFieldValidator=function(b,a){Nb.Core.Form.Validator.RequiredFieldValidator.superclass.constructor.apply(this,arguments)};Nb.Core.Form.Validator.extend(Nb.Core.Form.Validator.RequiredFieldValidator,{validate:function(a,b){this.isValid=!this.isEmpty(a);return this.isValid}});Nb.Core.Form.Validator.DateValidator=function(b,a){Nb.Core.Form.Validator.DateValidator.superclass.constructor.apply(this,arguments)};Nb.Core.Form.Validator.extend(Nb.Core.Form.Validator.DateValidator,{validate:function(c,d){this.isValid=true;if(this.isEmpty(c)){return this.isValid}this.isValid=false;if(!c.match(/^[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}$/)){return this.isValid}var b=c.split("-");var a=new Date(b[0],b[1]-1,b[2]);this.isValid=((Number)(a.getDate())==(Number)(b[2])&&((Number)(a.getMonth())+1)==(Number)(b[1]));return this.isValid}});Nb.Core.Form.Validator.EmailValidator=function(b,a){Nb.Core.Form.Validator.EmailValidator.superclass.constructor.apply(this,arguments)};Nb.Core.Form.Validator.extend(Nb.Core.Form.Validator.EmailValidator,{validate:function(b,c){this.isValid=true;if(this.isEmpty(b)){return this.isValid}var a=/^[a-z0-9!#$%&\'*+\/=?\^_`{|}~\-]+(?:\.[a-z0-9!#$%&'*+\/=?\^_{|}~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?$/i;if(b.match(a)){this.isValid=true}else{this.isValid=false}return this.isValid}});Nb.Core.Form.Validator.RegExpValidator=function(b,a){this.superclass=Nb.Core.Form.Validator.RegExpValidator.superclass;this.superclass.constructor.apply(this,arguments)};Nb.Core.Form.Validator.extend(Nb.Core.Form.Validator.RegExpValidator,{init:function(b){this.superclass.init.call(this,b);var e=b.pattern.split("/");var d="";for(var c=1;c<e.length-1;c++){d+=e[c];if(c<e.length-2){d+="/"}}var a=e[e.length-1];this.pattern=new RegExp(d,a)},validate:function(a,b){this.isValid=true;if(this.isEmpty(a)){return this.isValid}this.isValid=this.pattern.test(a);return this.isValid}});(function(){var a={ar:/^[B-T]{1}[0-9]{4}[A-Z]{3}$/i,at:/^[0-9]{4}$/i,au:/^[0-9]{4}$/i,be:/^[1-9][0-9]{3}$/i,ca:/^[a-z][0-9][a-z][\s\t\-]*[0-9][a-z][0-9]$/i,ch:/^[0-9]{4}$/i,cn:/^[0-9]{6}$/,de:/^[0-9]{5}$/i,dk:/^(DK-)?[0-9]{4}$/i,ee:/^[0-9]{5}$/,es:/^[0-4][0-9]{4}$/,fi:/^(FI-)?[0-9]{5}$/i,fr:/^(0[1-9]|[1-9][0-9])[0-9][0-9][0-9]$/i,"in":/^[1-9]{1}[0-9]{2}(\s|-)?[0-9]{3}$/i,it:/^[0-9]{5}$/,is:/^[0-9]{3}$/,lv:/^(LV-)?[1-9][0-9]{3}$/i,mx:/^[0-9]{5}$/,nl:/^[0-9]{4}.?[a-z]{2}$/i,no:/^[0-9]{4}$/,nz:/^[0-9]{4}$/,pl:/^[0-9]{2}-[0-9]{3}$/,pt:/^[0-9]{4}-[0-9]{3}$/,ru:/^[0-9]{6}$/,se:/^[0-9]{3}\s?[0-9]{2}$/,tr:/^[0-9]{5}$/,uk:/^[a-z][a-z0-9]{1,3}\s?[0-9][a-z]{2}$/i,us:/^[0-9]{5}((-| )[0-9]{4})?$/};Nb.Core.Form.Validator.ZipCodeValidator=function(c,b){this.superclass=Nb.Core.Form.Validator.ZipCodeValidator.superclass;this.superclass.constructor.apply(this,arguments)};Nb.Core.Form.Validator.extend(Nb.Core.Form.Validator.ZipCodeValidator,{init:function(b){this.superclass.init.call(this,b);this.countries=b.countries},validate:function(g,h){this.isValid=true;if(this.isEmpty(g)){return this.isValid}var b=this.countries;var e=this.countries.length,f;this.isValid=false;if(e>0){for(var c=0;c<e;c++){f=a[b[c]];if(f.test(g)){this.isValid=true;return this.isValid}}}else{for(var d in a){if(a.hasOwnProperty(d)){f=a[d];if(f.test(g)){this.isValid=true;return this.isValid}}}}return this.isValid}})})();(function(){var a=Nb.Lib;Nb.Core.Form.ErrorProvider=function(b){Nb.Core.Form.ErrorProvider.superclass.constructor.apply(this,arguments)};Nb.Core.Form.ErrorProvider.NAME="Nb.Core.Form.ErrorProvider";Nb.Core.Form.ErrorProvider.ATTRS={};a.extend(Nb.Core.Form.ErrorProvider,a.Base,{hide:function(){},show:function(b){}})})();(function(){var a=Nb.Lib;Nb.Core.Form.ErrorProvider.ToolTipErrorProvider=function(b){Nb.Core.Form.ErrorProvider.ToolTipErrorProvider.superclass.constructor.apply(this,arguments)};Nb.Core.Form.ErrorProvider.ToolTipErrorProvider.NAME="Nb.Core.Form.ErrorProvider.ToolTipErrorProvider";Nb.Core.Form.ErrorProvider.ToolTipErrorProvider.ATTRS={className:{value:"tooltip"}};a.extend(Nb.Core.Form.ErrorProvider.ToolTipErrorProvider,Nb.Core.Form.ErrorProvider,{_getToolTip:function(){if(!this._tooltip){this._tooltip=new Nb.Core.UI.ToolTip({align:"left",offsetLeft:-5,offsetTop:-10,className:this.get("className")});this._tooltip.render(document.body)}return this._tooltip},hide:function(){this._getToolTip().hide()},show:function(f,j){if(this.timer){this.timer.cancel()}var d=f.get("controls"),e,h,c=j[0].fieldName,b=j[0].message;for(e=0;e<d.length;e++){h=d[e];if(h.get("name")==c){break}}var g=this._getToolTip();g.set("text",b);g.show(h.element);this.timer=a.later(3000,this,this.hide)}})})();(function(){var b=Nb.Lib;var a="-visible";YUI.namespace.call(window,"Nb.Core.UI");Nb.Core.UI.ToolTip=function(c){Nb.Core.UI.ToolTip.superclass.constructor.apply(this,arguments);this.on("destroy",this._onDestroy,this);this._visibleClassName=this.get("className")+a};Nb.Core.UI.ToolTip.NAME="tooltip";Nb.Core.UI.ToolTip.ATTRS={align:{value:"left"},className:{value:"tooltip"},offsetLeft:{value:0},offsetTop:{value:0},text:{value:"",getter:function(c){return c},setter:function(c){if(this.element){this.element.one("."+this.get("className")+"-content").set("innerHTML",c)}return c}}};b.extend(Nb.Core.UI.ToolTip,b.Base,{_getHtml:function(){var c=this.get("className");return['<div class="'+c+'">','<div class="'+c+'-content"></div>','<div class="'+c+'-corner"></div>',"</div>"].join("")},_onDestroy:function(){b.Event.purgeElement(this._domEl,true);this.element.remove()},_setPositionRelTo:function(c){if(c instanceof b.Node){if(c.getStyle("display")=="none"){do{c=c.get("nextSibling");if(c.getStyle("display")!="none"){break}}while(c)}if(!c){return}var d=c.getXY();if(this.get("align")=="center"){d[0]-=parseInt(this.element.get("offsetWidth")/2,10)-parseInt(c.get("offsetWidth")/2,10)-Number(this.get("offsetLeft"))}else{d[0]+=Number(this.get("offsetLeft"))}d[1]-=this.element.get("offsetHeight")-Number(this.get("offsetTop"));this.element.setXY(d)}},hide:function(){this.element.removeClass(this._visibleClassName)},isVisible:function(){return this.element.hasClass(this._visibleClassName)},render:function(c){c=b.one(c);this.element=b.one(b.DOM.create(this._getHtml()));c.appendChild(this.element)},show:function(d){this.element.addClass(this._visibleClassName);this._setPositionRelTo(d);try{d.select()}catch(c){}}})})();(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI");Nb.Core.UI.Item=function(){Nb.Core.UI.Item.superclass.constructor.apply(this,arguments)};Nb.Core.UI.Item.NAME="item";Nb.Core.UI.Item.ATTRS={className:{value:"list-item"},listBox:{value:null},parent:{value:null}};a.extend(Nb.Core.UI.Item,a.Base,{getClassAttr:function(){var d=this.get("className");var c="";if(arguments.length>0){for(var b=0;b<arguments.length;b++){if(b>0){c+=" "}c+=d+arguments[b]}}else{c=d}return c.length>0?'class="'+c+'"':""},render:function(){}});Nb.Core.UI.Item.factory=function(b){switch(b.type){case"item_radio":return new Nb.Core.UI.Item.RadioItem(b);case"item_list":return new Nb.Core.UI.Item.ListItem(b);case"item_separator":return new Nb.Core.UI.Item.Separator(b);default:return null}}})();(function(){var d="-li";var f="-highlight";var a="-anchor";var i="-checkbox";var e="-text";var j="-li-checked";var h="-li-selected";var c="-li-level";var g="-li-disabled";var b=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI.Item");Nb.Core.UI.Item.ListItem=function(k){Nb.Core.UI.Item.ListItem.superclass.constructor.apply(this,arguments);this.on("destroy",this._onDestroy,this);this.publish("key")};Nb.Core.UI.Item.ListItem.NAME="listItem";Nb.Core.UI.Item.ListItem.ATTRS={checkable:{value:false},checked:{value:false,setter:function(k){if(!this.get("checkable")){return k}var l=j;this._setClass(k,l);if(!this.get("enabled")){l+=g;this._setClass(k,l)}return k}},elementId:{value:null},enabled:{value:true,setter:function(k){var l=g;if(!k){this.set("selectable",false)}this._setClass(!k,l);if(this.get("checked")){l=j+l;this._setClass(!k,l)}return k}},highlight:{value:false,setter:function(k){this._setClass(k,f);if(k){this.focus()}}},items:{value:[],setter:function(k){for(var l=0;l<k.length;l++){if(!(k[l] instanceof Nb.Core.UI.Item)){k[l]=new Nb.Core.UI.Item.ListItem(k[l])}}}},listBox:{value:null},selectable:{value:true},selected:{value:false,setter:function(k){this._setClass(k,h);if(k){this.focus()}return k}},tag:{value:null},text:{value:""},value:{value:null},itemCount:{value:0,readOnly:true,getter:function(m){var k=this.get("items");var n=k.length;for(var l=0;l<k.length;l++){n+=k[l].get("itemCount")}return n}}};Nb.Lib.extend(Nb.Core.UI.Item.ListItem,Nb.Core.UI.Item,{_getHtml:function(o){var n=[];var m=[d,c+o];if(!this.get("enabled")&&this.get("checked")){m.push(g);m.push(j+g)}else{if(!this.get("enabled")){m.push(g)}if(this.get("checked")&&this.get("checkable")){m.push(j)}}var l=b.guid(this.get("className"));this.set("elementId",l);var k=this.getClassAttr.apply(this,m);n.push("<li "+k+' id="'+l+'">');n.push('<a href="#" '+this.getClassAttr(a)+">");if(this.get("checkable")){n.push("<span "+this.getClassAttr(i)+"></span>")}n.push("<span "+this.getClassAttr(e)+">"+this.get("text")+"</span>");n.push("</a>");n.push("</li>");return n.join("")},_onDestroy:function(){b.Event.purgeElement(this.element,true);this.element.destroy()},_onKey:function(k){this.fire("key",k)},_onMouseEnter:function(k){this.set("highlight",true)},_onMouseLeave:function(k){this.set("highlight",false)},_setClass:function(l,k){if(!this.element){return}var m=l?"addClass":"removeClass";this.element[m](this.get("className")+k)},focus:function(){if(this.element&&this.element.get("offsetHeight")>0){this.element.get("offsetHeight")}},onClick:function(l){var k=l.target.hasClass(this.get("className")+i);if(k&&this.get("enabled")){this.set("checked",!this.get("checked"))}else{if(this.get("selectable")){this.set("selected",true)}else{if(!this.get("selectable")&&this.get("checkable")&&this.get("enabled")){this.set("checked",!this.get("checked"))}}}},render:function(k,p,m){k=b.one(k);var o=this._getHtml(p);this.element=b.one(b.DOM.create(o));this.element.on("mouseenter",this._onMouseEnter,this);this.element.on("mouseleave",this._onMouseLeave,this);this.keyListener=new Nb.Core.KeyNav(this.element.get("firstChild"));this.keyListener.on("key",this._onKey,this);k.appendChild(this.element);m[this.element.get("id")]=this;var l=this.get("items");for(var n=0;n<l.length;n++){l[n].set("checkable",this.get("checkable"));l[n].set("parent",this);l[n].set("listBox",this.get("listBox"));l[n].render(k,p+1,m)}return this.element}})})();YUI.namespace.call(window,"Nb.Core.UI.Item");Nb.Core.UI.Item.RadioItem=function(a){Nb.Core.UI.Item.RadioItem.superclass.constructor.apply(this,arguments)};Nb.Core.UI.Item.RadioItem.NAME="radioItem";Nb.Core.UI.Item.RadioItem.ATTRS={listBox:{value:null,setter:function(a){if(a instanceof Nb.Core.UI.Control.ListBox){a.on("itemChecked",this._onListBoxItemCheck,this)}return a}}};Nb.Lib.extend(Nb.Core.UI.Item.RadioItem,Nb.Core.UI.Item.ListItem,{_onListBoxItemCheck:function(d){var b=d.target.getAllItems();var a=d.item instanceof Nb.Core.UI.Item.RadioItem;for(var c=0;c<b.length;c++){if(a&&d.item!=b[c]){b[c].set("checked",false)}else{if(!a&&b[c] instanceof Nb.Core.UI.Item.RadioItem){b[c].set("checked",false)}}}}});YUI.namespace.call(window,"Nb.Core.UI.Item");Nb.Core.UI.Item.Separator=function(){};Nb.Lib.extend(Nb.Core.UI.Item.Separator,Nb.Core.UI.Item);(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI.Control");Nb.Core.UI.Control=function(b){Nb.Core.UI.Control.superclass.constructor.apply(this,arguments)};Nb.Core.UI.Control.NAME="control";Nb.Core.UI.Control.ATTRS={className:{value:""},container:{value:null},elementId:{value:""},name:{value:null},value:{value:null}};a.extend(Nb.Core.UI.Control,Nb.Core.Component,{getClassAttr:function(){var d=this.get("className");var c="";if(arguments.length>0){for(var b=0;b<arguments.length;b++){if(b>0){c+=" "}c+=d+arguments[b]}}else{c=d}return c.length>0?'class="'+c+'"':""},render:function(){}})})();(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI.Control");Nb.Core.UI.Control.TextBox=function(b){Nb.Core.UI.Control.TextBox.superclass.constructor.apply(this,arguments);this.element=a.one("#"+this.get("elementId"));if(!this.element){throw new Error('Nb.Core.UI.TextBox: element with id "'+this.get("elementId")+'" and name: "'+this.get("name")+"\" couldn't be found.")}if(this.get("hideDefaultValue")){this.element.on("focus",this._onFocus,this);this.element.on("blur",this._onBlur,this)}this.set("loaded",true)};Nb.Core.UI.Control.TextBox.NAME="textbox";Nb.Core.UI.Control.TextBox.ATTRS={className:{value:"uc-textbox"},hideDefaultValue:{value:false},value:{lazyAdd:false,getter:function(b){b=this.element.get("value");if(this.get("hideDefaultValue")&&b==this.element.get("defaultValue")){b=""}return b},setter:function(b){if(this.element){this.element.set("value",b)}}}};a.extend(Nb.Core.UI.Control.TextBox,Nb.Core.UI.Control,{_onBlur:function(b){if(this.element.get("value")===""){this.element.set("value",this.element.get("defaultValue"))}},_onFocus:function(b){if(this.element.get("value")===this.element.get("defaultValue")){this.element.set("value","")}}})})();(function(){var d=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI.Control");var b="-checked";var c="-label";var a="click";Nb.Core.UI.Control.CheckBox=function(e){Nb.Core.UI.Control.CheckBox.superclass.constructor.apply(this,arguments);this.publish(a,{emitFacade:true});this.checkbox=d.one("#"+this.get("elementId"));if(!this.checkbox){throw new Error('Nb.Core.UI.CheckBox: element with id "'+this.get("elementId")+"\" couldn't be found.")}this.render();this.set("loaded",true)};Nb.Core.UI.Control.CheckBox.NAME="checkbox";Nb.Core.UI.Control.CheckBox.ATTRS={lazyAdd:false,checked:{value:false,setter:function(f){if(this.element){var e=this.get("className")+b;if(f){this.element.addClass(e)}else{this.element.removeClass(e)}}return f}},label:{value:""},value:{value:"",getter:function(e){return this.get("checked")?e:""}}};d.extend(Nb.Core.UI.Control.CheckBox,Nb.Core.UI.Control,{_getHtml:function(){var e="";if(this.get("label").length>0){e="<div "+this.getClassAttr(c)+">"+this.get("label")+"</div>"}var f=["<div "+this.getClassAttr()+">",e,"</div>"];return f.join("")},_onClick:function(){this.set("checked",!this.get("checked"));this.fire(a)},render:function(){if(this.get("label")){this.checkbox.next().remove()}this._element=d.DOM.create(this._getHtml());this.element=d.one(this._element);this.element.on("click",this._onClick,this);var e=this.checkbox.get("parentNode");e.insertBefore(this.element,this.checkbox);this.checkbox.remove();this.set("checked",this.get("checked"))}})})();(function(){var f=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI.Control");var d="-content";var b="-overlay";var e="-spans";var a="-span";var c=a+"-active";Nb.Core.UI.Control.DatePicker=function(g){Nb.Core.UI.Control.DatePicker.superclass.constructor.apply(this,arguments);this._init();this.set("loaded",true)};Nb.Core.UI.Control.DatePicker.NAME="datePicker";Nb.Core.UI.Control.DatePicker.ATTRS={autoSwitch:{value:true},className:{value:"uc-datepicker"},defaultView:{value:"day"},hideOnSelect:{value:true},locale:{value:{firstDayInWeek:0,weekDayNames:["su","mo","tu","we","th","fr","sa"],monthNames:["January","February","March","April","May","Juny","July","August","September","October","November","December"],monthShortNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],spanNames:["Year","Month","Day"]}},selectedMonth:{value:null},selectedDate:{value:null,getter:function(j){if(j===null){var g=this.dayInput.get("value");var k=this.monthInput.get("value");var i=this.yearInput.get("value");if(i=="0000"||!i.match(/^[0-9]{4}$/)){var h=new Date();j=new Date(h.getFullYear(),h.getMonth(),h.getDate(),0,0,0)}else{j=new Date(i,k-1,g,0,0,0)}}return j},setter:function(g){if(g){this.dayInput.set("value",g.getDate());this.monthInput.set("value",g.getMonth()+1);this.yearInput.set("value",g.getFullYear());this._updateHidden()}return g}},value:{lazyAdd:false,getter:function(g){return this._hiddenEl.get("value")},setter:function(g){if(this._hiddenEl){this._hiddenEl.set("value",g)}}}};f.extend(Nb.Core.UI.Control.DatePicker,Nb.Core.UI.Control,{_beginTransition:function(h){var g=this._overlayEl;g.setStyle("visibility","visible");if(!this._overlayAnim){this._overlayAnim=new f.Anim({node:g,to:{opacity:1},duration:0.2,ease:f.Easing.easeStrong});this._overlayAnim.on("end",this._onTransitionAnimEnd,this)}if(this._overlayAnim.get("running")){this._overlayAnim.stop(false)}this._overlayAnim.set("ease",f.Easing.easeOutStrong);this._overlayAnim.set("to.opacity",1);this._overlayAnim.run();this._onTransitionEnd=h},_changeView:function(){if(this.view){this.view.destroy()}this._spans.removeClass("uc-datepicker-span-active");this._spans.item(this._currentSpanId).addClass("uc-datepicker-span-active");this._spansEl.setStyle("display","none");this._spansEl.setStyle("display","block");var h=Nb.Core.UI.Control.DatePicker;var g=h.MonthView;switch(this._currentSpanId){case 0:g=h.YearListView;break;case 1:g=h.MonthListView;break;case 2:g=h.MonthView;break;default:g=h.MonthView;break}this.view=new g({datePicker:this});this.view.on("select",this._onItemSelect,this);f.Event.purgeElement(this._contentEl,true);this._contentEl.set("innerHTML","");this.view.render(this._contentEl);this._endTransition()},_endTransition:function(){if(!this._overlayAnim){return}if(this._overlayAnim.get("running")){this._overlayAnim.stop(false)}this._overlayAnim.set("to.opacity",0);this._overlayAnim.set("ease",f.Easing.easeInStrong);this._overlayAnim.run();this._onTransitionEnd=null},_getInputHtml:function(){var j=this.get("elementId");var k=this.get("name");var i=/\[[0-9a-z_\-]*\]/;var n=k.match(i);var g=n?k.replace(i,"")+"_day":k+"_day";var h=n?k.replace(i,"")+"_month":k+"_month";var l=n?k.replace(i,"")+"_year":k+"_year";var m=this.get("className");if(!j||!k){throw new Error("Element ID not found.")}return['<input type="text" class="'+m+'-day" id="'+j+'-day" name="'+g+'" />','<input type="text" class="'+m+'-month" id="'+j+'-month" name="'+h+'" />','<input type="text" class="'+m+'-year" id="'+j+'-year" name="'+l+'" />','<input type="hidden" name="'+this.get("name")+'" id="'+j+'" value="" />'].join("")},_getHtml:function(){return['<div class="'+this.get("className")+' unselectable" unselectable="on">',"<div "+this.getClassAttr(b)+"></div>","<div "+this.getClassAttr(d)+"></div>","<div "+this.getClassAttr(e)+">",this._getSpansHtml(),"</div>","</div>"].join("")},_getSpansHtml:function(){var k=this.get("locale.spanNames");var j=[],h;for(var g=0;g<k.length;g++){h=[a,a+g];if(g==this._activeSpan){h.push(c)}j.push('<a href="" '+this.getClassAttr.apply(this,h)+">"+k[g]+"</a>")}return j.join("")},_getSpanIdByName:function(g){switch(g){case"month":return 1;case"year":return 0;case"day":return 2;default:return 2}},_init:function(){var g=this.get("elementId");this._hiddenEl=f.one("#"+g);if(!this._hiddenEl){return}this.dayInput=f.one("#"+g+"-day");this.monthInput=f.one("#"+g+"-month");this.yearInput=f.one("#"+g+"-year");this.dayInput.on("change",this._onChange,this);this.monthInput.on("change",this._onChange,this);this.yearInput.on("change",this._onChange,this);this.element=this.dayInput;if(this.get("selectedMonth")===null){var h=this.get("selectedDate")||new Date();this.set("selectedMonth",new Date(h.getFullYear(),h.getMonth(),1,0,0,0))}if(this._hiddenEl){this._renderIcon(this._hiddenEl.get("parentNode"))}},_onChange:function(k){var g=this.dayInput.get("value");var j=this.monthInput.get("value");var i=this.yearInput.get("value");if(i!="0000"&&i.match(/^[0-9]{4}$/)){var h=new Date(i,j-1,g,0,0,0);this.set("selectedDate",h)}else{this._hiddenEl.set("value","0000-00-00")}},_onClick:function(j){var g=this.get("className")+a;var i=j.target.hasClass(g);if(i){j.halt();this._beginTransition(this._changeView);var h=new RegExp(g+"([0-9])","i");this._currentSpanId=Number(h.exec(j.target.get("className"))[1])}},_onDocClick:function(g){if(this._isVisible&&!this.element.contains(g.target)){this.hide()}},_onIconClick:function(g){g.stopPropagation();if(this._isVisible){this.hide()}else{this.show()}},_onItemSelect:function(g){if(this._currentSpanId<2){if(this.get("autoSwitch")){this._currentSpanId++;this._beginTransition(this._changeView)}}else{if(this._currentSpanId==2&&this.get("hideOnSelect")){f.later(100,this,this.hide)}}},_onTransitionAnimEnd:function(g){if(this._onTransitionEnd){this._onTransitionEnd()}else{this._overlayEl.setStyle("visibility","hidden")}},_render:function(g){this._activeSpan=2;var h=f.one(f.DOM.create(this._getHtml()));g.appendChild(h);var i=this.get("className");this._contentEl=h.one("."+i+d);this._overlayEl=h.one("."+i+b);this._spansEl=h.one("."+i+e);this._spans=h.all("."+i+a);h.on("click",this._onClick,this);this.element=h;var j=this._iconEl.getXY();j[0]+=this._iconEl.get("offsetWidth")+6;this.element.setXY(j);f.on("click",this._onDocClick,document,this)},_renderIcon:function(h){var g=['<span class="'+this.get("className")+'-icon">',"</span>"];this._iconEl=h.appendChild(f.DOM.create(g.join("")));this._iconEl.on("click",this._onIconClick,this)},_updateHidden:function(){var h=this.get("selectedDate");var g=h.getDate();var j=h.getMonth()+1;var i=h.getFullYear();this._hiddenEl.set("value",i+"-"+j+"-"+g)},hide:function(){if(this.element){this.element.setStyle("visibility","hidden");var g=this.get("selectedDate");if(g){var h=new Date(g.getFullYear(),g.getMonth(),1,0,0,0);this.set("selectedMonth",h)}}this._isVisible=false},render:function(g){var h=this._getInputHtml();g.appendChild(f.DOM.create(h));this._init()},setView:function(g){this._currentSpanId=this._getSpanIdByName(g);this._beginTransition(this._changeView)},show:function(){if(!this._rendered){this._rendered=true;this._render(this._hiddenEl.get("parentNode"))}this._currentSpanId=this._getSpanIdByName(this.get("defaultView"));this._changeView();this.element.setStyle("visibility","visible");this._isVisible=true}})})();(function(){var a=Nb.Lib;Nb.Core.UI.Control.DatePicker.DatePickerView=function(b){Nb.Core.UI.Control.DatePicker.DatePickerView.superclass.constructor.apply(this,arguments);this.on("destroy",this._onDestroy,this);this.publish("select",{emitFacade:true})};Nb.Core.UI.Control.DatePicker.DatePickerView.NAME="datePickerView";Nb.Core.UI.Control.DatePicker.DatePickerView.ATTRS={datePicker:{value:null,setter:function(b){if(b instanceof Nb.Core.UI.Control.DatePicker){this._selMonthListener=b.after("selectedMonthChange",this._onSelectedMonthChange,this)}return b}}};a.extend(Nb.Core.UI.Control.DatePicker.DatePickerView,a.Base,{_onDestroy:function(b){this._selMonthListener.detach();this.detachAll("select");this.element.detach("click",this._onClick,this);this.element.destroy()},_onSelectedMonthChange:function(){},render:function(){}})})();(function(){var b=Nb.Lib;var p=7;var h="-month-view";var f="-weekdays";var j=f+"-ul";var n="-weekday";var d="-days";var a="-days-ul";var c="-cell";var i="-cell-inactive";var e="-cell-today";var l="-cell-selected";var o="-current";var g=o+"-text";var k="-next";var m="-previous";Nb.Core.UI.Control.DatePicker.MonthView=function(q){this.superclass=Nb.Core.UI.Control.DatePicker.MonthView.superclass;this.superclass.constructor.apply(this,arguments)};Nb.Core.UI.Control.DatePicker.MonthView.NAME="monthView";Nb.Core.UI.Control.DatePicker.MonthView.ATTRS={datePicker:{value:null,setter:function(q){if(q instanceof Nb.Core.UI.Control.DatePicker){this._selMonthListener=q.after("selectedMonthChange",this._onSelectedMonthChange,this);this._selDateListener=q.after("selectedDateChange",this._onSelectedDateChange,this)}return q}}};b.extend(Nb.Core.UI.Control.DatePicker.MonthView,Nb.Core.UI.Control.DatePicker.DatePickerView,{_correctDst:function(q){if(q.getHours()===0){return q}else{if(q.getHours()==23){return new Date(q.getTime()+3600*1000)}else{if(q.getHours()==1){return new Date(q.getTime()-3600*1000)}}}return q},_getStartDate:function(t,u,q){var s=new Date(t,u,1,0,0,0,0);var r=s.getDay();while(r!=q){s=this._correctDst(new Date(s.getTime()-24*3600*1000));r=s.getDay()}return s},_getEndDate:function(u,v,q){var t=(v==11)?new Date(u+1,0,1,0,0,0):new Date(u,v+1,1,0,0,0);var s=this._correctDst(new Date(t.getTime()-24*3600*1000));var r=s.getDay();var w=q+p-1;if(w>=p){w-=p}while(r!=w){s=this._correctDst(new Date(s.getTime()+24*3600*1000));r=s.getDay()}return s},_getHtml:function(){var r=this.get("datePicker");var q=["<div "+r.getClassAttr(h)+">","<div "+r.getClassAttr(o)+">","<div "+r.getClassAttr(g)+"></div>",'<a href="#next" '+r.getClassAttr(k)+"></a>",'<a href="#prev" '+r.getClassAttr(m)+"></a>","</div>","<div "+r.getClassAttr(f)+">",this._getWeekDaysHtml(),"</div>","<div "+r.getClassAttr(d)+">","<ul "+r.getClassAttr(a)+">","</ul>",'<div class="clear"></div>',"</div>","</div>"];return q.join("")},_getDaysHtml:function(){var D=this.get("datePicker");var q=D.get("selectedMonth");if(!q){return""}var y=D.get("locale.firstDayInWeek");var s=this._getStartDate(q.getFullYear(),q.getMonth(),y);var x=this._getEndDate(q.getFullYear(),q.getMonth(),y);var B=new Date().toLocaleDateString();var z=D.get("selectedDate");var r=z?z.toLocaleDateString():"";var u=s.getTime(),t=null,w=x.getTime(),v=[],A,C;while(u<=w){t=new Date(u);A=[c];var E=(t.getMonth()==q.getMonth()&&t.getFullYear()==q.getFullYear());if(!E){A.push(i)}C=t.toLocaleDateString();if(C==B){A.push(e)}if(C==r){A.push(l)}v.push("<li "+D.getClassAttr.apply(D,A)+">");v.push(t.getDate());v.push("</li>");u+=24*3600*1000;t=this._correctDst(new Date(u));u=t.getTime()}return v.join("")},_getWeekDaysHtml:function(){var u=this.get("datePicker");var w=u.get("locale.weekDayNames");var q=u.get("locale.firstDayInWeek");var t=w.length,v,s=["<ul ",u.getClassAttr(j),">"];for(var r=q;r<t+q;r++){v=r>=t?r-t:r;s.push("<li "+u.getClassAttr(c,n)+">");s.push(w[v]);s.push("</li>")}s.push("</ul>");s.push('<div class="clear"></div>');return s.join("")},_onClick:function(x){var B=this.get("datePicker");var y=B.get("className");var D=y+k;var q=y+m;var r=y+c;var s=y+i;var u=y+n;var t;if(x.target.hasClass(D)||x.target.hasClass(q)){x.halt();var A=x.target.hasClass(D)?1:-1;t=B.get("selectedMonth");var z=t.getFullYear();var w=t.getMonth();w+=A;if(w==12){z+=1;w=0}else{if(w==-1){z-=1;w=11}}B.set("selectedMonth",new Date(z,w,1,0,0,0))}else{if(x.target.hasClass(r)&&!x.target.hasClass(s)&&!x.target.hasClass(u)){t=B.get("selectedMonth");var C=x.target.get("innerHTML");var v=new Date(t.getTime());v.setDate(C);B.set("selectedDate",v);this.fire("select")}}},_onCurrentClick:function(q){q.halt();this.get("datePicker").setView("month")},_onDestroy:function(q){this.superclass._onDestroy.call(this,q);this._selDateListener.detach()},_onSelectedMonthChange:function(q){if(q.newVal){this._renderCurrent();this._renderDays()}},_onSelectedDateChange:function(w){var y=this.get("datePicker");var v=y.get("selectedDate");var r=y.get("selectedMonth");var q=r.getFullYear()==v.getFullYear();var s=r.getMonth()==v.getMonth();var x=y.get("className");var u=x+i;var t=x+l;var z=v.getDate();this._days.each(function(A){if(A.hasClass(u)){return}if(q&&s&&A.get("innerHTML")==z){A.addClass(t)}else{A.removeClass(t)}this.fire("select")})},_renderCurrent:function(){var s=this.get("datePicker");var q=s.get("locale.monthNames")[s.get("selectedMonth").getMonth()];var r=s.get("selectedMonth").getFullYear();this._currentTextEl.set("innerHTML",q+" "+r)},_renderDays:function(){this._daysEl.set("innerHTML",this._getDaysHtml());this._days=this._daysEl.all(".uc-datepicker-cell")},render:function(q){this.element=b.one(b.DOM.create(this._getHtml()));q.appendChild(this.element);this.element.on("click",this._onClick,this);var r=this.get("datePicker").get("className");this._currentTextEl=this.element.one("."+r+g);this._currentTextEl.on("click",this._onCurrentClick,this);this._daysEl=this.element.one("."+r+a);this._days=this._daysEl.all(".uc-datepicker-cell");this._renderDays();this._renderCurrent()}})})();(function(){var c=Nb.Lib;var f="-month-list";var b="-month-row";var h="-month-item";var d="-month-item-selected";var a="-month-item-today";var j="-current";var e=j+"-text";var g="-next";var i="-previous";Nb.Core.UI.Control.DatePicker.MonthListView=function(k){Nb.Core.UI.Control.DatePicker.MonthListView.superclass.constructor.apply(this,arguments)};Nb.Core.UI.Control.DatePicker.MonthListView.NAME="monthListView";Nb.Core.UI.Control.DatePicker.MonthListView.ATTRS={};c.extend(Nb.Core.UI.Control.DatePicker.MonthListView,Nb.Core.UI.Control.DatePicker.DatePickerView,{_getHtml:function(){var k=this.get("datePicker");return["<div "+k.getClassAttr(f)+">","<div "+k.getClassAttr(j)+">","<div "+k.getClassAttr(e)+"></div>",'<a href="#next" '+k.getClassAttr(g)+"></a>",'<a href="#prev" '+k.getClassAttr(i)+"></a>","</div>",this._getMonthListHtml(),"</div>"].join("")},_getMonthListHtml:function(){var t=this.get("datePicker");var m=t.get("selectedMonth").getMonth();var s=new Date().getMonth();var p=t.get("locale.monthShortNames");var u=4;var v=p.length/u;var q=[],l,k,r;q.push("<div>");for(var o=0;o<u;o++){q.push("<div "+t.getClassAttr(b)+">");for(var n=0;n<v;n++){l=o*v+n;r=[h];if(l==m){r.push(d)}if(l==s){r.push(a)}k=t.getClassAttr.apply(t,r);q.push('<a href="#month'+l+'" '+k+">");q.push(p[l]);q.push("</a>")}q.push('<div class="clear"></div>');q.push("</div>")}q.push("</div>");return q.join("")},_onClick:function(o){var s=this.get("datePicker");var p=s.get("className");var t=p+g;var l=p+i;var k=p+h;var m,q,n;if(o.target.hasClass(t)||o.target.hasClass(l)){o.halt();var r=o.target.hasClass(t)?1:-1;m=s.get("selectedMonth");q=m.getFullYear();n=m.getMonth();s.set("selectedMonth",new Date(q+r,n,1,0,0,0))}else{if(o.target.hasClass(k)){o.halt();m=s.get("selectedMonth");q=m.getFullYear();n=this._monthes.indexOf(o.target);s.set("selectedMonth",new Date(q,n,1,0,0,0));this.fire("select")}}},_onCurrentClick:function(k){k.halt();this.get("datePicker").setView("year")},_onSelectedMonthChange:function(n){this._renderCurrent();var l=this.get("datePicker");var m=l.get("selectedMonth").getMonth();var k=l.get("className");this._monthes.removeClass(k+d);this._monthes.item(m).addClass(k+d)},_renderCurrent:function(){var l=this.get("datePicker");var k=l.get("selectedMonth").getFullYear();this._currentTextEl.set("innerHTML",k)},render:function(k){this.element=c.one(c.DOM.create(this._getHtml()));k.appendChild(this.element);this.element.on("click",this._onClick,this);var l=this.get("datePicker").get("className");this._currentTextEl=this.element.one("."+l+e);this._currentTextEl.on("click",this._onCurrentClick,this);this._monthes=this.element.all("."+l+h);this._renderCurrent()}})})();(function(){var a=Nb.Lib;var b="-year-list";var h="-years";var g="-year-column";var j="-year-item";var i="-year-item-selected";var c="-year-item-today";var n="-current";var f=n+"-text";var k="-next";var m="-previous";var e=3;var d=5;var l=e*d;Nb.Core.UI.Control.DatePicker.YearListView=function(o){Nb.Core.UI.Control.DatePicker.YearListView.superclass.constructor.apply(this,arguments);this._displayedYear=this.get("datePicker").get("selectedMonth").getFullYear()};Nb.Core.UI.Control.DatePicker.YearListView.NAME="yearListView";Nb.Core.UI.Control.DatePicker.YearListView.ATTRS={};a.extend(Nb.Core.UI.Control.DatePicker.YearListView,Nb.Core.UI.Control.DatePicker.DatePickerView,{_getHtml:function(){var o=this.get("datePicker");return["<div "+o.getClassAttr(b)+">","<div "+o.getClassAttr(n)+">","<div "+o.getClassAttr(f)+"></div>",'<a href="#next" '+o.getClassAttr(k)+"></a>",'<a href="#prev" '+o.getClassAttr(m)+"></a>","</div>","<div "+o.getClassAttr(h)+">",this._getYearListHtml(),"</div>","</div>"].join("")},_getYearListHtml:function(){var v=this.get("datePicker");var x=v.get("selectedMonth").getFullYear();var w=new Date().getFullYear();var s=this._displayedYear-Math.floor(l/2);var r=[],o,t,u;r.push("<div>");for(var q=0;q<e;q++){r.push("<div "+v.getClassAttr(g)+">");for(var p=0;p<d;p++){u=s+q*d+p;t=[j];if(u==x){t.push(i)}if(u==w){t.push(c)}o=v.getClassAttr.apply(v,t);r.push('<a href="#year'+u+'" '+o+">");r.push(u);r.push("</a>")}r.push("</div>")}r.push('<div class="clear"></div>');r.push("</div>");return r.join("")},_onClick:function(s){var w=this.get("datePicker");var t=w.get("className");var x=t+k;var o=t+m;var q=t+j;var p,u,r;if(s.target.hasClass(x)||s.target.hasClass(o)){s.halt();var v=s.target.hasClass(x)?1:-1;this._displayedYear+=l*v;this._renderYears()}else{if(s.target.hasClass(q)){s.halt();p=w.get("selectedMonth");r=p.getMonth();u=s.target.get("innerHTML");w.set("selectedMonth",new Date(u,r,1,0,0,0));this.fire("select")}}},_onSelectedMonthChange:function(s){this._renderCurrent();var r=this.get("datePicker");var q=r.get("selectedMonth").getFullYear();var p=r.get("className"),o;this._years.each(function(t){o=t.get("innerHTML");if(o==q){t.addClass(p+i)}else{t.removeClass(p+i)}})},_renderCurrent:function(){var p=this.get("datePicker");var o=p.get("selectedMonth").getFullYear();this._currentTextEl.set("innerHTML",o)},_renderYears:function(){this._yearsEl.set("innerHTML",this._getYearListHtml());var o=this.get("datePicker").get("className");this._years=this.element.all("."+o+j)},render:function(o){this.element=a.one(a.DOM.create(this._getHtml()));o.appendChild(this.element);this.element.on("click",this._onClick,this);var p=this.get("datePicker").get("className");this._currentTextEl=this.element.one("."+p+f);this._yearsEl=this.element.one("."+p+h);this._years=this.element.all("."+p+j);this._renderCurrent()}})})();(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI.Control");Nb.Core.UI.Control.Hidden=function(b){Nb.Core.UI.Control.Hidden.superclass.constructor.apply(this,arguments);this.element=a.one("#"+this.get("elementId"));if(!this.element){throw new Error('Nb.Core.UI.Hidden: element with id "'+this.get("elementId")+"\" couldn't be found.")}this.set("loaded",true)};Nb.Core.UI.Control.Hidden.NAME="hidden";Nb.Core.UI.Control.Hidden.ATTRS={value:{lazyAdd:false,getter:function(b){return this.element.get("value")},setter:function(b){if(this.element){this.element.set("value",b)}}}};a.extend(Nb.Core.UI.Control.Hidden,Nb.Core.UI.Control,{})})();(function(){var e=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI.Control");var c="-ul";var d="itemSelect";var a="itemChecked";var b="itemCheckedChange";Nb.Core.UI.Control.ListBox=function(f){Nb.Core.UI.Control.ListBox.superclass.constructor.apply(this,arguments);f=f||{};this._element=e.DOM.create(this._getHtml());this.element=e.one(this._element);this._itemHashes={};this._itemEvents=[];this._ulDomElement=this.element.one("ul");if(f.itemsSource!==null){this._setItemsSource(f.itemsSource)}this.on("destroy",this._onDestroy,this);this.publish(d,{emitFacade:true});this.publish(a,{emitFacade:true});if(f&&f.elementId){this.render("#"+f.elementId)}if(f.value){this.set("value",f.value)}this.set("loaded",true)};Nb.Core.UI.Control.ListBox.NAME="listBox";Nb.Core.UI.Control.ListBox.ATTRS={className:{value:"uc-listbox"},displayMember:{value:null},items:{lazyAdd:false,value:[],setter:function(f){var h;for(var g=0;g<f.length;g++){if(!(f[g] instanceof Nb.Core.UI.Item)){h=Nb.Core.UI.Item.factory(f[g]);if(h&&h instanceof Nb.Core.UI.Item){h.set("listBox",this);f[g]=h}else{throw new Error("Nb.Core.UI.ListBox: Item must be an instance of Nb.Core.UI.Item")}}}if(this._element){this._renderItems(f,0)}return f}},itemCount:{value:0,readOnly:true,getter:function(j){var f=this.get("items");var h=f.length,k=h;for(var g=0;g<h;g++){k+=f[g].get("itemCount")}return k}},itemsSource:{value:null,setter:function(f){this._setItemsSource(f);return f}},selectable:{value:true,setter:function(h){var f=this.get("items");if(!f){return}for(var g=0;g<f.length;g++){f[g].set("selectable",h)}return h}},selectionMode:{value:"single",setter:function(h){var f=this.get("items");if(!f){return}for(var g=0;g<f.length;g++){f[g].set("checkbox",h=="checkbox")}return h}},value:{lazyAdd:false,value:null,getter:function(g){var h=this.get("selectionMode")=="checkbox",f=h?"checked":"selected";g=this._getItemValuesByAttr(f,true);return g},setter:function(j){if(!(j instanceof Array)){j=[String(j)]}if(!this.get("items")){return j}var h=this.get("value");h.sort();j.sort();var l=e.JSON;var k=l.stringify(h)==l.stringify(j);if(k){return j}for(var g=0;g<j.length;g++){j[g]=String(j[g])}var m=this.get("selectionMode");var f=(m=="checkbox")?"checked":"selected";return this._setItemAttrByValues(f,true,j)}},valueMember:{value:null}};e.extend(Nb.Core.UI.Control.ListBox,Nb.Core.UI.Control,{_applyItemAttribute:function(i,j,g){var h;for(var f in this._itemHashes){if(this._itemHashes.hasOwnProperty(f)){h=this._itemHashes[f];if(h!=g){h.set(i,j)}}}},_destroyItems:function(){for(var f in this._itemHashes){if(this._itemHashes.hasOwnProperty(f)){this._itemHashes[f].destroy()}}this._removeItemsEvents()},_findPrev:function(m,f){f=f||this.get("items");var g=f.indexOf(m),l;if(g==-1){for(var j=0,k=f.length;j<k;j++){if(f[j].get("items")){l=this._findPrev(m,f[j].get("items"));if(l){return l}}}return null}if(g>0){l=f[g-1];if(l.get("items").length>0){var h=l.get("items").length-1;return l.get("items")[h]}return l}else{if(m.get("parent") instanceof Nb.Core.UI.Item.ListItem){return m.get("parent")}}return null},_findNext:function(n,h,f){if(n.get("items").length>0&&!f){return n.get("items")[0]}var j=h.indexOf(n);if(j==-1){for(var k=0,m=h.length;k<m;k++){if(h[k].get("items")){var l=this._findNext(n,h[k].get("items"),false);if(l){return l}}}return null}if(h.length-1>j){return h[j+1]}else{if(n.get("parent") instanceof Nb.Core.UI.Item.ListItem){var g=n.get("parent").get("parent").get("items");return this._findNext(n.get("parent"),g,true)}}return null},_getItemsByAttr:function(h,j){var i,f=[];for(var g in this._itemHashes){if(this._itemHashes.hasOwnProperty(g)){i=this._itemHashes[g];if(i.get(h)==j){f.push(i)}}}return f},_getItemValuesByAttr:function(j,l){var g=this._getItemsByAttr(j,l);var f=[],k=null;for(var h=0;h<g.length;h++){k=g[h].get("value");if(e.Array.indexOf(f,k)==-1){f.push(k)}}return f},_getHtml:function(){var f=["<div "+this.getClassAttr()+">","<ul "+this.getClassAttr(c)+">","</ul>","</div>"];return f.join("")},_getListItems:function(){if(!this._listItems){this._listItems=this.element.one("ul").get("childNodes")}return this._listItems},_onClick:function(h){h.preventDefault();if(!this._ulDomElement.contains(h.target)){return}var g=h.target,i=null;while(g!=this._ulDomElement){i=g.get("id");if(this._itemHashes[i]){break}g=g.get("parentNode")}var f=this._itemHashes[i];if(!f){return}f.onClick(h)},_onDestroy:function(){this.detachAll();e.Event.purgeElement(this._element,true);this.element.remove();this.element.set("innerHTML","");this.element.destroy()},_onItemCheckedChange:function(f){if(f.newVal){this.fire(a,{item:f.target})}this.fire(b,{item:f.target})},_onItemSelectedChange:function(f){if(f.newVal===true){this._applyItemAttribute("selected",false,f.target);this.fire(d,{item:f.target})}},_onItemHighlightChange:function(f){if(f.newVal===true){this._applyItemAttribute("highlight",false,f.target)}},_onKey:function(i){i.halt();var h=i.target;switch(i.keyName){case"down":var f=this._findNext(h,this.get("items"));if(f){f.set("highlight",true)}break;case"enter":if(this.get("selectable")){h.set("selected",true)}break;case"up":var g=this._findPrev(h);if(g){g.set("highlight",true)}break}},_removeItemsEvents:function(){for(var f=this._itemEvents.length-1;f>=0;f--){this._itemEvents[f].detach();this._itemEvents.splice(f,1)}},_renderItems:function(g,k){this._listItems=null;this._destroyItems();delete this._itemHashes;this._itemHashes={};var h=this.get("selectionMode")=="checkbox";var f=this.get("selectable");this._ulDomElement.set("innerHTML","");for(var j=0;j<g.length;j++){g[j].set("listBox",this);g[j].set("checkable",h);g[j].set("selectable",f);g[j].set("parent",this);g[j].render(this._ulDomElement,k,this._itemHashes)}this._setupItemsEvents()},_setItemsSource:function(h){var j=this.get("displayMember");var l=this.get("valueMember");h=h||this.get("itemsSource");if(!j||!l||!h||!(h instanceof Array)){return}var f=[];for(var g=0,k=h.length;g<k;g++){f.push(new Nb.Core.UI.Item.ListItem({text:h[g][j],value:h[g][l],tag:h[g]}))}this.set("items",f)},_setItemAttrByValues:function(i,k,g){var j;var f=[];for(var h in this._itemHashes){if(this._itemHashes.hasOwnProperty(h)){j=this._itemHashes[h];if(e.Array.indexOf(g,String(j.get("value")))!=-1){j.set(i,k);f.push(j.get("value"))}}}return g},_setupItemsEvents:function(){var g;for(var f in this._itemHashes){if(this._itemHashes.hasOwnProperty(f)){g=this._itemHashes[f];this._itemEvents.push(g.after("selectedChange",this._onItemSelectedChange,this),g.after("highlightChange",this._onItemHighlightChange,this),g.after("checkedChange",this._onItemCheckedChange,this),g.on("key",this._onKey,this))}}},focus:function(f){var g=this._getItemsByAttr("selected",true);if(g.length>0){g[0].focus()}else{if(this.get("items").length>0){this.get("items")[0].set("highlight",true)}}},getAllItems:function(){var g=[];for(var f in this._itemHashes){if(this._itemHashes.hasOwnProperty(f)){g.push(this._itemHashes[f])}}return g},hide:function(){this.element.setStyle("display","none")},render:function(f){f=e.one(f);if(!f){return false}this._renderItems(this.get("items"),0);if(f.get("nodeName").toLowerCase()=="select"){f.insert(this.element,"after");f.setStyle("display","none")}else{f.appendChild(this.element)}this.element.on("click",this._onClick,this);return true},selectItem:function(g){var f=this.get("items");if(!f[g]){throw new Error("Nb.Core.UI.Control.ListBox: item not found.")}f[g].set("selected",true)},show:function(){this.element.setStyle("display","block")}})})();(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI.Control");var g=10;var h="-ul";var i="-current";var b="-items";var j="-items-wrap";var e=8;var f="expand";var c="collapse";var d="change";Nb.Core.UI.Control.DropDown=function(k){this.superclass=Nb.Core.UI.Control.DropDown.superclass;this.superclass.constructor.apply(this,arguments);this._previousValue=null;this.publish(c,{emitFacade:true});this.publish(f,{emitFacade:true});this.publish(d,{emitFacade:true});this._isExpanded=false;this._toggleAnim=new a.Anim({node:this._getOptionsEl(),to:{height:0,top:0},duration:0.5,easing:a.Easing.easeOut});this._toggleAnim.on("end",this._onToggleAnimEnd,this);a.publish("dropdown:"+f,{emitFacade:true});this._events=[];this._events.push(a.on("dropdown:"+f,this._onAnyDropDownExpand,this));this._events.push(a.on("click",this._onDocClick,document,this));this._events.push(this.after("valueChange",this._onValueChange,this));this._updateCurrent()};Nb.Core.UI.Control.DropDown.NAME="dropdown";Nb.Core.UI.Control.DropDown.ATTRS={className:{value:"uc-dropdown"},current:{setter:function(k){var l=this._getCurrentEl();if(l){l.innerHTML=k}return k}},text:{value:{itemSelected:"1 item selected",itemsSelected:"{0} items selected"}}};a.extend(Nb.Core.UI.Control.DropDown,Nb.Core.UI.Control.ListBox,{_animationsEnabled:function(){var k=this.get("items");return k.length<60},_getHtml:function(){var l=this.get("className")+i+" unselectable";var k=["<div "+this.getClassAttr()+">",'<div unselectable="on" class="'+l+'"></div>',"<div "+this.getClassAttr(b)+">","<div "+this.getClassAttr(j)+">","<ul "+this.getClassAttr(h)+">","</ul>","</div>","</div>","</div>"];return k.join("")},_getListItemsDom:function(){if(!this._listItemsDom){this._listItemsDom=a.Node.getDOMNode(this.element.one("ul")).childNodes}return this._listItemsDom},_onAnyDropDownExpand:function(k){if(this.isExpanded()&&k.dropDown!=this){this.collapse()}},_onClick:function(k){if(k.target==a.one(this._getCurrentEl())){k.preventDefault();this.toggle()}else{this.superclass._onClick.call(this,k);this._updateCurrent()}},_onDestroy:function(){this.superclass._onDestroy.call(this);for(var k=0;k<this._events.length;k++){this._events[k].detach()}},_onDocClick:function(k){if(this.isExpanded()&&!this.element.contains(k.target)){k.preventDefault();this.collapse()}},_getCurrentEl:function(){return this._element.firstChild},_onItemSelectedChange:function(k){this.superclass._onItemSelectedChange.call(this,k);if(this.get("selectionMode")!="checkbox"){this.collapse()}},_getOptionsEl:function(){if(!this._optionsEl){this._optionsEl=this.element.one("."+this.get("className")+b)}return this._optionsEl},_onToggleAnimEnd:function(){if(!this._isExpanded){this._getOptionsEl().setStyle("visibility","hidden")}},_onValueChange:function(){this._updateCurrent()},_renderItems:function(k,l){this._heightUpdated=false;this._listItemsDom=null;this.superclass._renderItems.call(this,k,l)},_updateCurrent:function(){if(this.get("selectionMode")=="checkbox"){var k=this._getItemsByAttr("checked",true);if(k.length==1){this.set("current",k[0].get("text"))}else{var m=this.get("text.itemsSelected");var l=Nb.Core.Util.formatString(m,k.length);this.set("current",l)}}else{var n=this._getItemsByAttr("selected",true);if(n.length>0){this.set("current",n[0].get("text"))}}},_updateHeight:function(){if(this._heightUpdated){return}var o=this._getOptionsEl().get("firstChild");o.setStyle("height","auto");o.setStyle("overflowY","hidden");var l=this.get("items");if(this.get("itemCount")>e){var p=this._getListItemsDom();var k=0;var n=Math.min(p.length,e);for(var m=0;m<n;m++){k+=p[m].offsetHeight}o.setStyle("height",k+"px");o.setStyle("overflowX","hidden");o.setStyle("overflowY","scroll")}this._heightUpdated=true},collapse:function(){if(!this._isExpanded){return}var o=this._getCurrentEl();var k=this._getOptionsEl();var m=this._toggleAnim;if(m&&m.get("running")){m.stop()}var n=Number(k.getStyle("top").replace(/px/,""));var l=a.DOM.getY(o)>k.getY();if(l){n+=k.get("offsetHeight")}else{n-=o.offsetHeight-1}if(this._animationsEnabled()){m.set("to.height",0);m.set("to.top",n);m.set("easing",a.Easing.easeIn);m.run()}else{k.setStyle("height","0px");k.setStyle("top",n+"px")}var p=a.JSON.stringify(this.get("value"));if(p!=this._previousValue){this.fire(d,{prevValue:a.JSON.parse(this._previousValue),newValue:this.get("value")})}this._isExpanded=false},expand:function(){if(this._isExpanded){return}this.element.setStyle("zIndex",++g);var q=this._getCurrentEl();var p=a.DOM.getXY(q);var k=this._getOptionsEl();k.setXY(p);k.setStyle("height",0);k.setStyle("visibility","visible");this._updateHeight();var m=this._toggleAnim;if(m&&m.get("running")){m.stop()}var o=Number(k.getStyle("top").replace(/px/,""));var r=k.get("firstChild").get("offsetHeight");var l=p[1]+q.offsetHeight+r;var n=a.DOM.docScrollY()+a.DOM.winHeight();if(l<n){o+=q.offsetHeight-1}else{o-=r}if(this._animationsEnabled()){m.set("to.height",r);m.set("to.top",o);m.set("easing",a.Easing.easeOut);m.run()}else{k.setStyle("height",r+"px");k.setStyle("top",o+"px")}this._isExpanded=true;this._previousValue=a.JSON.stringify(this.get("value"));this.fire(f);a.fire("dropdown:"+f,{dropDown:this});this.focus()},isExpanded:function(){return this._isExpanded},render:function(k){this.superclass.render.call(this,k);if(this.get("selectionMode")=="checkbox"){this._updateCurrent()}else{if((!this.get("value")||this.get("value").length===0)&&this.get("items").length>0){this.selectItem(0)}}},selectItem:function(k){this.superclass.selectItem.call(this,k);this.collapse();this._updateCurrent()},toggle:function(){if(this.isExpanded()){this.collapse()}else{this.expand()}}})})();(function(){var c=Nb.Lib;var b="-checked";var a="-highlight";YUI.namespace.call(window,"Nb.Core.UI.Control");Nb.Core.UI.Control.ToggleButton=function(d){Nb.Core.UI.Control.ToggleButton.superclass.constructor.apply(this,arguments);this.element=c.DOM.create(this._getHtml());c.Event.generateId(this.element);this.element=c.one(this.element)};Nb.Core.UI.Control.ToggleButton.NAME="Nb.Core.UI.Control.ToggleButton";Nb.Core.UI.Control.ToggleButton.ATTRS={className:{value:"uc-radio-button"},checked:{value:false,setter:function(d){this._toggleClass(d,b);return d}},highlight:{value:false,setter:function(d){this._toggleClass(d,a);return d}},text:{value:""},tag:{value:null},value:{value:""}};c.extend(Nb.Core.UI.Control.ToggleButton,c.Base,{_getHtml:function(){return'<div class="'+this.get("className")+'">'+this.get("text")+"</div>"},_toggleClass:function(f,d){var e=f?"addClass":"removeClass";this.element[e](this.get("className")+d)},render:function(d){c.one(d).appendChild(this.element)}})})();(function(){var b=Nb.Lib;YUI.namespace.call(window,"Nb.Core.UI.Control");var a="itemChecked";Nb.Core.UI.Control.ItemGroup=function(c){Nb.Core.UI.Control.ItemGroup.superclass.constructor.apply(this,arguments);this.publish(a);this.on("destroy",this._onDestroy,this);this.element=b.one(b.DOM.create(this._getHtml()));this.element.on("click",this._onClick,this);this.element.on("mouseover",this._onMouseOver,this);this.element.on("mouseout",this._onMouseOut,this);if(this.get("elementId")){this.render()}this.set("loaded",true)};Nb.Core.UI.Control.ItemGroup.NAME="itemGroup";Nb.Core.UI.Control.ItemGroup.ATTRS={className:{value:"uc-item-group"},displayMember:{value:"text"},items:{setter:function(c){if(c instanceof Array){for(var d=0;d<c.length;d++){if(!(c[d] instanceof Nb.Core.UI.Control.ToggleButton)){throw new Error("Nb.Core.UI.Control.ItemGroup: each item must be an instance of Nb.Core.UI.Control.ToggleButton")}}}else{if(typeof c!="undefined"){throw new Error("Nb.Core.UI.Control.ItemGroup: items must be an Array")}}return c},value:[]},itemsSource:{lazyAdd:false,value:null,setter:function(c){this._setItemsSource(c);return c}},value:{value:null,lazyAdd:false,setter:function(g){var c=this.get("items");if(c instanceof Array){for(var d=0,e=c.length;d<e;d++){var f=(c[d].get("value")==g);c[d].set("checked",f)}}return g}},valueMember:{value:"value"}};b.extend(Nb.Core.UI.Control.ItemGroup,Nb.Core.UI.Control,{_createItem:function(e,d,c){return new Nb.Core.UI.Control.ToggleButton({text:e,value:d,tag:c})},_getHtml:function(){return"<div "+this.getClassAttr()+"></div>"},_getItem:function(c){var d=c.get("id");if(d&&this._hashTable.hasOwnProperty(d)){return this._hashTable[d]}return null},_onClick:function(d){var c=this._getItem(d.target);if(c){c.set("checked",!c.get("checked"))}},_onDestroy:function(c){this.element.detachAll()},_onItemChecked:function(c){this.fire(a,c)},_onMouseOver:function(d){var c=this._getItem(d.target);if(c){c.set("highlight",true)}},_onMouseOut:function(d){var c=this._getItem(d.target);if(c){c.set("highlight",false)}},_renderItems:function(){this._hashTable={};var c=this.get("items");for(var d=0;d<c.length;d++){c[d].render(this.element);if(this.get("value")==c[d].get("value")){c[d].set("checked",true)}c[d].on("checkedChange",this._onItemChecked,this);this._hashTable[c[d].element.get("id")]=c[d]}},_setItemsSource:function(e){var f=this.get("displayMember");var h=this.get("valueMember");e=e||this.get("itemsSource");if(!f||!h||!e||!(e instanceof Array)){return}var c=[];for(var d=0,g=e.length;d<g;d++){c.push(this._createItem(e[d][f],e[d][h],e[d]))}this.set("items",c);this.set("value",this.get("value"))},render:function(c){if(!c&&this.get("elementId")){c=b.one("#"+this.get("elementId"));c.set("innerHTML","")}else{c=b.one(c)}this._renderItems();c.appendChild(this.element)},setCheckedItem:function(c){this.set("value",c.get("value"))}})})();(function(){var b=Nb.Lib;var a="itemChecked";YUI.namespace.call(window,"Nb.Core.UI.Control");Nb.Core.UI.Control.RadioButtonGroup=function(c){Nb.Core.UI.Control.RadioButtonGroup.superclass.constructor.apply(this,arguments)};Nb.Core.UI.Control.RadioButtonGroup.NAME="radioButtonGroup";Nb.Core.UI.Control.RadioButtonGroup.ATTRS={className:{value:"uc-radio-button-group"}};b.extend(Nb.Core.UI.Control.RadioButtonGroup,Nb.Core.UI.Control.ItemGroup,{_createItem:function(e,d,c){return new Nb.Core.UI.Control.ToggleButton({className:"uc-radio-button",text:e,value:d,tag:c})},_onClick:function(d){var c=this._getItem(d.target);if(c){c.set("checked",true)}},_onItemChecked:function(c){if(!c.newVal||this._isSettingValue){return}if(this.get("value")!=c.target.get("value")){this._isSettingValue=true;this.set("value",c.target.get("value"));this._isSettingValue=false}this.fire(a,c)}})})();(function(){var a=Nb.Lib;Nb.Core.UI.Control.FileUpload=function(b){Nb.Core.UI.Control.FileUpload.superclass.constructor.apply(this,arguments);this.element=a.one("#"+this.get("elementId"));if(!this.element){throw new Error("Nb.Core.UI.Control.FileUpload: Element with ID "+this.get("elementId")+" couldn't be found.")}this.element.one("input").on("change",this._onFileSelect,this);this._form=this.element.ancestor(function(c){return(c.get("tagName").toLowerCase()=="form")});if(!this._form){throw new Error("FileUpload field must be inside form element.")}};Nb.Core.UI.Control.FileUpload.NAME="Nb.Core.UI.Control.FileUpload";Nb.Core.UI.Control.FileUpload.ATTRS={url:{value:null},text:{value:{}}};a.extend(Nb.Core.UI.Control.FileUpload,Nb.Core.UI.Control,{_getOutput:function(){return this.element.one("."+this.get("className")+"-output")},_onFileSelect:function(b){this._oldAction=this._form.get("action");this._getOutput().set("innerHTML",this.get("text.pleaseWait"));this._fileName=b.target.get("value").replace("C:\\fakepath\\","");a.io(this.get("url"),{form:{id:this._form.get("id"),upload:true},method:"post",on:{complete:this._onUploadCompleteData},context:this})},_onUploadCompleteData:function(e,c){var d=a.JSON.parse(c.responseText);if(d.success){this.set("value",d.id);this._getOutput().set("innerHTML",this._fileName)}else{if(d.error){var b=this.get("container");if(b&&b.get("errorProvider")){b.get("errorProvider").show([{fieldName:this.get("name"),message:d.error}])}else{alert(d.error)}this._getOutput().set("innerHTML","")}else{this._getOutput().set("innerHTML","")}}this._form.set("action",this._oldAction)}})})();(function(){var a=Nb.Lib;Nb.Core.UI.Control.SubmitButton=function(b){Nb.Core.UI.Control.SubmitButton.superclass.constructor.apply(this,arguments);if(this.get("elementId")){this.element=a.one("#"+this.get("elementId"))}if(!(this.get("form") instanceof Nb.Core.Form)){throw new Error("Nb.Core.UI.Control.SubmitButton: form must be an instance of Nb.Core.Form type")}this.element.on("click",this._onClick,this)};Nb.Core.UI.Control.SubmitButton.NAME="Nb.Core.UI.Control.SubmitButton";Nb.Core.UI.Control.SubmitButton.ATTRS={form:{value:null},url:{value:null}};a.extend(Nb.Core.UI.Control.SubmitButton,Nb.Core.UI.Control,{_onClick:function(c){var b=this.get("form");b.submit(this.get("url"))}})})();(typeof Crypto=="undefined"||!Crypto.util)&&function(){var c=window.Crypto={},a=c.util={rotl:function(d,f){return d<<f|d>>>32-f},rotr:function(d,f){return d<<32-f|d>>>f},endian:function(d){if(d.constructor==Number){return a.rotl(d,8)&16711935|a.rotl(d,24)&4278255360}for(var f=0;f<d.length;f++){d[f]=a.endian(d[f])}return d},randomBytes:function(d){for(var f=[];d>0;d--){f.push(Math.floor(Math.random()*256))}return f},bytesToWords:function(g){for(var h=[],d=0,f=0;d<g.length;d++,f+=8){h[f>>>5]|=g[d]<<24-f%32}return h},wordsToBytes:function(f){for(var g=[],d=0;d<f.length*32;d+=8){g.push(f[d>>>5]>>>24-d%32&255)}return g},bytesToHex:function(f){for(var g=[],d=0;d<f.length;d++){g.push((f[d]>>>4).toString(16)),g.push((f[d]&15).toString(16))}return g.join("")},hexToBytes:function(f){for(var g=[],d=0;d<f.length;d+=2){g.push(parseInt(f.substr(d,2),16))}return g},bytesToBase64:function(h){if(typeof btoa=="function"){return btoa(b.bytesToString(h))}for(var i=[],d=0;d<h.length;d+=3){for(var f=h[d]<<16|h[d+1]<<8|h[d+2],g=0;g<4;g++){d*8+g*6<=h.length*8?i.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>6*(3-g)&63)):i.push("=")}}return i.join("")},base64ToBytes:function(g){if(typeof atob=="function"){return b.stringToBytes(atob(g))}for(var g=g.replace(/[^A-Z0-9+\/]/ig,""),h=[],d=0,f=0;d<g.length;f=++d%4){f!=0&&h.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(g.charAt(d-1))&Math.pow(2,-2*f+8)-1)<<f*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(g.charAt(d))>>>6-f*2)}return h}},c=c.charenc={};c.UTF8={stringToBytes:function(d){return b.stringToBytes(unescape(encodeURIComponent(d)))},bytesToString:function(d){return decodeURIComponent(escape(b.bytesToString(d)))}};var b=c.Binary={stringToBytes:function(f){for(var g=[],d=0;d<f.length;d++){g.push(f.charCodeAt(d)&255)}return g},bytesToString:function(f){for(var g=[],d=0;d<f.length;d++){g.push(String.fromCharCode(f[d]))}return g.join("")}}}();(function(){var k=Crypto,g=k.util,h=k.charenc,i=h.UTF8,l=h.Binary,a=k.SHA1=function(b,c){var d=g.wordsToBytes(a._sha1(b));return c&&c.asBytes?d:c&&c.asString?l.bytesToString(d):g.bytesToHex(d)};a._sha1=function(D){D.constructor==String&&(D=i.stringToBytes(D));var C=g.bytesToWords(D),w=D.length*8,D=[],B=1732584193,x=-271733879,A=-1732584194,z=271733878,F=-1009589776;C[w>>5]|=128<<24-w%32;C[(w+64>>>9<<4)+15]=w;for(w=0;w<C.length;w+=16){for(var y=B,t=x,e=A,u=z,q=F,j=0;j<80;j++){if(j<16){D[j]=C[w+j]}else{var E=D[j-3]^D[j-8]^D[j-14]^D[j-16];D[j]=E<<1|E>>>31}E=(B<<5|B>>>27)+F+(D[j]>>>0)+(j<20?(x&A|~x&z)+1518500249:j<40?(x^A^z)+1859775393:j<60?(x&A|x&z|A&z)-1894007588:(x^A^z)-899497514);F=z;z=A;A=x<<30|x>>>2;x=B;B=E}B+=y;x+=t;A+=e;z+=u;F+=q}return[B,x,A,z,F]};a._blocksize=16;a._digestsize=20})();(function(){var h=Crypto,a=h.util,b=h.charenc,g=b.UTF8,i=b.Binary;h.HMAC=function(c,f,j,e){f.constructor==String&&(f=g.stringToBytes(f));j.constructor==String&&(j=g.stringToBytes(j));j.length>c._blocksize*4&&(j=c(j,{asBytes:!0}));for(var n=j.slice(0),j=j.slice(0),m=0;m<c._blocksize*4;m++){n[m]^=92,j[m]^=54}c=c(n.concat(c(j.concat(f),{asBytes:!0})),{asBytes:!0});return e&&e.asBytes?c:e&&e.asString?i.bytesToString(c):a.bytesToHex(c)}})();(function(){var h=Crypto,a=h.util,b=h.charenc,g=b.UTF8,i=b.Binary;h.PBKDF2=function(x,y,p,o){function z(f,k){return h.HMAC(t,k,f,{asBytes:!0})}x.constructor==String&&(x=g.stringToBytes(x));y.constructor==String&&(y=g.stringToBytes(y));for(var t=o&&o.hasher||h.SHA1,w=o&&o.iterations||1,d=[],A=1;d.length<p;){for(var v=z(x,y.concat(a.wordsToBytes([A]))),e=v,c=1;c<w;c++){for(var e=z(x,e),j=0;j<v.length;j++){v[j]^=e[j]}}d=d.concat(v);A++}d.length=p;return o&&o.asBytes?d:o&&o.asString?i.bytesToString(d):a.bytesToHex(d)}})();(function(h){function a(c,d){var e=c._blocksize*4;return e-d.length%e}var b=h.pad={},g=function(c){for(var d=c.pop(),e=1;e<d;e++){c.pop()}};b.NoPadding={pad:function(){},unpad:function(){}};b.ZeroPadding={pad:function(c,d){var f=c._blocksize*4,j=d.length%f;if(j!=0){for(j=f-j;j>0;j--){d.push(0)}}},unpad:function(){}};b.iso7816={pad:function(c,d){var f=a(c,d);for(d.push(128);f>1;f--){d.push(0)}},unpad:function(c){for(;c.pop()!=128;){}}};b.ansix923={pad:function(d,f){for(var j=a(d,f),k=1;k<j;k++){f.push(0)}f.push(j)},unpad:g};b.iso10126={pad:function(d,f){for(var j=a(d,f),k=1;k<j;k++){f.push(Math.floor(Math.random()*256))}f.push(j)},unpad:g};b.pkcs7={pad:function(d,f){for(var j=a(d,f),k=0;k<j;k++){f.push(j)}},unpad:g};var h=h.mode={},i=h.Mode=function(c){if(c){this._padding=c}};i.prototype={encrypt:function(c,d,f){this._padding.pad(c,d);this._doEncrypt(c,d,f)},decrypt:function(c,d,f){this._doDecrypt(c,d,f);this._padding.unpad(d)},_padding:b.iso7816};g=(h.ECB=function(){i.apply(this,arguments)}).prototype=new i;g._doEncrypt=function(d,f){for(var j=d._blocksize*4,k=0;k<f.length;k+=j){d._encryptblock(f,k)}};g._doDecrypt=function(d,f){for(var j=d._blocksize*4,k=0;k<f.length;k+=j){d._decryptblock(f,k)}};g.fixOptions=function(c){c.iv=[]};g=(h.CBC=function(){i.apply(this,arguments)}).prototype=new i;g._doEncrypt=function(f,j,l){for(var n=f._blocksize*4,m=0;m<j.length;m+=n){if(m==0){for(var k=0;k<n;k++){j[k]^=l[k]}}else{for(k=0;k<n;k++){j[m+k]^=j[m+k-n]}}f._encryptblock(j,m)}};g._doDecrypt=function(j,k,n){for(var p=j._blocksize*4,o=0;o<k.length;o+=p){var l=k.slice(o,o+p);j._decryptblock(k,o);for(var m=0;m<p;m++){k[o+m]^=n[m]}n=l}};g=(h.CFB=function(){i.apply(this,arguments)}).prototype=new i;g._padding=b.NoPadding;g._doEncrypt=function(j,m,o){for(var n=j._blocksize*4,o=o.slice(0),l=0;l<m.length;l++){var k=l%n;k==0&&j._encryptblock(o,0);m[l]^=o[k];o[k]=m[l]}};g._doDecrypt=function(o,k,q){for(var p=o._blocksize*4,q=q.slice(0),n=0;n<k.length;n++){var m=n%p;m==0&&o._encryptblock(q,0);var l=k[n];k[n]^=q[m];q[m]=l}};g=(h.OFB=function(){i.apply(this,arguments)}).prototype=new i;g._padding=b.NoPadding;g._doEncrypt=function(m,o,n){for(var l=m._blocksize*4,n=n.slice(0),k=0;k<o.length;k++){k%l==0&&m._encryptblock(n,0),o[k]^=n[k%l]}};g._doDecrypt=g._doEncrypt;h=(h.CTR=function(){i.apply(this,arguments)}).prototype=new i;h._padding=b.NoPadding;h._doEncrypt=function(o,q,p){for(var n=o._blocksize*4,k=0;k<q.length;){var m=p.slice(0);o._encryptblock(m,0);for(var l=0;k<q.length&&l<n;l++,k++){q[k]^=m[l]}++p[n-1]==256&&(p[n-1]=0,++p[n-2]==256&&(p[n-2]=0,++p[n-3]==256&&(p[n-3]=0,++p[n-4])))}};h._doDecrypt=h._doEncrypt})(Crypto);(function(){function I(h,k){for(var f=0,g=0;g<8;g++){k&1&&(f^=h);var j=h&128,h=h<<1&255;j&&(h^=27);k>>>=1}return f}for(var D=Crypto,G=D.util,H=D.charenc.UTF8,J=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],K=[],L=0;L<256;L++){K[J[L]]=L}for(var C=[],B=[],i=[],E=[],p=[],x=[],L=0;L<256;L++){C[L]=I(L,2),B[L]=I(L,3),i[L]=I(L,9),E[L]=I(L,11),p[L]=I(L,13),x[L]=I(L,14)}var v=[0,1,2,4,8,16,32,64,128,27,54],F=[[],[],[],[]],z,w,A,y=D.AES={encrypt:function(j,e,f){var f=f||{},g=f.mode||new D.mode.OFB;g.fixOptions&&g.fixOptions(f);var j=j.constructor==String?H.stringToBytes(j):j,h=f.iv||G.randomBytes(y._blocksize*4),e=e.constructor==String?D.PBKDF2(e,h,32,{asBytes:!0}):e;y._init(e);g.encrypt(y,j,h);j=f.iv?j:h.concat(j);return f&&f.asBytes?j:G.bytesToBase64(j)},decrypt:function(j,e,f){var f=f||{},g=f.mode||new D.mode.OFB;g.fixOptions&&g.fixOptions(f);var j=j.constructor==String?G.base64ToBytes(j):j,h=f.iv||j.splice(0,y._blocksize*4),e=e.constructor==String?D.PBKDF2(e,h,32,{asBytes:!0}):e;y._init(e);g.decrypt(y,j,h);return f&&f.asBytes?j:H.bytesToString(j)},_blocksize:4,_encryptblock:function(o,g){for(var c=0;c<y._blocksize;c++){for(var l=0;l<4;l++){F[c][l]=o[g+l*4+c]}}for(c=0;c<4;c++){for(l=0;l<4;l++){F[c][l]^=A[l][c]}}for(var q=1;q<w;q++){for(c=0;c<4;c++){for(l=0;l<4;l++){F[c][l]=J[F[c][l]]}}F[1].push(F[1].shift());F[2].push(F[2].shift());F[2].push(F[2].shift());F[3].unshift(F[3].pop());for(l=0;l<4;l++){var c=F[0][l],n=F[1][l],m=F[2][l],k=F[3][l];F[0][l]=C[c]^B[n]^m^k;F[1][l]=c^C[n]^B[m]^k;F[2][l]=c^n^C[m]^B[k];F[3][l]=B[c]^n^m^C[k]}for(c=0;c<4;c++){for(l=0;l<4;l++){F[c][l]^=A[q*4+l][c]}}}for(c=0;c<4;c++){for(l=0;l<4;l++){F[c][l]=J[F[c][l]]}}F[1].push(F[1].shift());F[2].push(F[2].shift());F[2].push(F[2].shift());F[3].unshift(F[3].pop());for(c=0;c<4;c++){for(l=0;l<4;l++){F[c][l]^=A[w*4+l][c]}}for(c=0;c<y._blocksize;c++){for(l=0;l<4;l++){o[g+l*4+c]=F[c][l]}}},_decryptblock:function(r,o){for(var g=0;g<y._blocksize;g++){for(var q=0;q<4;q++){F[g][q]=r[o+q*4+g]}}for(g=0;g<4;g++){for(q=0;q<4;q++){F[g][q]^=A[w*4+q][g]}}for(var n=1;n<w;n++){F[1].unshift(F[1].pop());F[2].push(F[2].shift());F[2].push(F[2].shift());F[3].push(F[3].shift());for(g=0;g<4;g++){for(q=0;q<4;q++){F[g][q]=K[F[g][q]]}}for(g=0;g<4;g++){for(q=0;q<4;q++){F[g][q]^=A[(w-n)*4+q][g]}}for(q=0;q<4;q++){var g=F[0][q],m=F[1][q],h=F[2][q],b=F[3][q];F[0][q]=x[g]^E[m]^p[h]^i[b];F[1][q]=i[g]^x[m]^E[h]^p[b];F[2][q]=p[g]^i[m]^x[h]^E[b];F[3][q]=E[g]^p[m]^i[h]^x[b]}}F[1].unshift(F[1].pop());F[2].push(F[2].shift());F[2].push(F[2].shift());F[3].push(F[3].shift());for(g=0;g<4;g++){for(q=0;q<4;q++){F[g][q]=K[F[g][q]]}}for(g=0;g<4;g++){for(q=0;q<4;q++){F[g][q]^=A[q][g]}}for(g=0;g<y._blocksize;g++){for(q=0;q<4;q++){r[o+q*4+g]=F[g][q]}}},_init:function(b){z=b.length/4;w=z+6;y._keyexpansion(b)},_keyexpansion:function(d){A=[];for(var c=0;c<z;c++){A[c]=[d[c*4],d[c*4+1],d[c*4+2],d[c*4+3]]}for(c=z;c<y._blocksize*(w+1);c++){d=[A[c-1][0],A[c-1][1],A[c-1][2],A[c-1][3]],c%z==0?(d.push(d.shift()),d[0]=J[d[0]],d[1]=J[d[1]],d[2]=J[d[2]],d[3]=J[d[3]],d[0]^=v[c/z]):z>6&&c%z==4&&(d[0]=J[d[0]],d[1]=J[d[1]],d[2]=J[d[2]],d[3]=J[d[3]]),A[c]=[A[c-z][0]^d[0],A[c-z][1]^d[1],A[c-z][2]^d[2],A[c-z][3]^d[3]]}}}})();YUI.namespace.call(window,"Nb.Black5");Nb.Black5.Model=function(a){for(var b in a){this[b]=a[b]}};Nb.Black5.Model.prototype={};YUI.namespace.call(window,"Nb.Black5");(function(){var a=Nb.Lib;Nb.Black5.FpsManager=function(b){var c={timerDelays:[16,25,33,40],curDelay:0,slowFrames:0,history:[],lastI:-1,add:function(d){this.lastI=++this.lastI%30;this.history[this.lastI]=d;d>this.timerDelays[this.curDelay]*0.001+0.03?this.slowFrames++:this.slowFrames=0;if(this.slowFrames>21&&this.curDelay+1<this.timerDelays.length){this.slowFrames=0,this.curDelay++,this.start(this.curDelay)}},average:function(){var e=0,d;for(d in this.history){e+=this.history[d]}return e/this.history.length},onFrame:function(d){b.onFrame(d);if(!b.frameTimer){var e=c.startTimer;e(c.onFrame)}},start:function(d){if(b.frameTimer){clearInterval(b.frameTimer)}d=d||0;var e=this.startTimer;e(this.onFrame,this.timerDelays[d])},startTimer:function(e,d){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(g,f){b.frameTimer=window.setInterval(g,f)}}()};return c}}());Nb.Black5.BackgroundController={items:[],element:document.getElementById("black"),current:null,lastPos:-1000,getBgId:function(a){var e,d,b=this.items,c;for(e in b){c=b[e].frames.stagePosition;for(d=0;d<c.length;d++){if(c[d]>=a){return e}}}return null},position:function(h,a){a=a||this.getBgId(h);if(!a){return}if(!this.current||this.current.id!==a){this.update(a)}var e=this.current,g=e.frames.stagePosition,b=g.length,f,m=false;for(f=0;f<b;f++){if(h<=g[f]){m=true;break}}var c=e.frames.left,k=f>0?f-1:0,d=f,l;if(k===d||!m||c[k]===c[d]){l=c[k];this.setPosition(l);return}var j=(h-g[k])/(g[d]-g[k]),l=(c[d]-c[k])*j+c[k];this.setPosition(l)},setPosition:function(a){if(this.lastPos===a){return}this.element.style.left=a+"%";this.lastPos=a},update:function(b){var a=this.items[b];this.element.style.width=a.width;this.current=a}};(function(){var b=Nb.Lib;var a="select";var d="active";var c="pin-nav-li-a";Nb.Black5.Navigation=function(){this.publish("select",{emitFacade:true});b.one("#logo-link").on("click",function(h){h.halt();this.setActive("/",true)},this);b.one("#utz-link").on("click",function(h){h.halt();this.setActive("/top-qualitaet/100-prozent-fuer-black5.html",true)},this);var g=b.all(".nav-ul a");g.on("click",this.onNavItemClick,this);var f={},e;g.each(function(h){e=h.get("href").match(/http:\/\/[^/]+(.*)$/i)[1];h.navKey=e;f[e]=h});this.urlCache=f};b.extend(Nb.Black5.Navigation,Nb.Black5.Model,{getMainItem:function(e){return e.ancestor(function(f){return f.hasClass("nav-li")}).one("a")},markActive:function(e){if(this.activeItem){this.activeItem.removeClass(d);if(this.activeItem.hasClass(c)){this.getMainItem(this.activeItem).removeClass(d)}}this.activeItem=this.urlCache[e];if(!this.activeItem){return;throw new Error("Menu item with ID: "+e+" not found.")}this.activeItem.addClass(d);if(this.activeItem.hasClass(c)){this.getMainItem(this.activeItem).addClass(d)}},onNavItemClick:function(g){g.halt();var f=g.currentTarget;this.setActive(f.navKey,true)},setActive:function(e,f){this.markActive(e);this.fire(a,{href:e,isClick:f,item:this.activeItem})}});b.augment(Nb.Black5.Navigation,b.EventTarget)}());Nb.Black5.EncryptedXhr={send:function(b,d,e,c){var a=this.mtd;d=Nb.Lib.JSON.stringify(d);if(Nb.PageConfig.stOn){d=a(d,Nb.Black5.EncryptedXhr.st)}return Nb.Lib.io(b,{method:"post",data:d,on:{complete:e},context:c})}};(function(){var a=Nb.Lib;Nb.Black5.MetaNavigation=function(){this.formName="customer-support"};Nb.Black5.MetaNavigation.prototype={getLayer:function(){if(!this.layer){this.layer=new Nb.Black5.Layer({width:805});this.layer.render(document.body);this.layer.on("close",this.onClose,this)}return this.layer},onClose:function(){a.one("#overlay").removeClass("visible");this.isVisible=false},onContactTypeChange:function(b){if(this.form){this.form.destroy()}this.formName=b.newValue[0];this.showPage(this.currentHref,this.currentItem)},onGetContent:function(d,c){var b=a.JSON.parse(c.responseText);this.setLayerContent(b.html);if(b.formConfig){this.form=new Nb.Core.Form(b.formConfig);this.form.getControlByName("subject").on("change",this.onContactTypeChange,this);this.form.on("submitError",this.onSubmitError,this);this.form.on("submitComplete",this.onSubmitComplete,this)}},onSubmitComplete:function(b){this.form.destroy();this.setLayerContent(b.response.html)},onSubmitError:function(b){a.one(".contact-captcha img").set("src","/captcha/?rnd="+Math.random())},setLayerContent:function(c){var b=this.getLayer(),d=c.match(/<h3>(.*)<\/h3>/),e="";if(d){c=c.replace(d[0],"");e=d[1]}b.set("content",c);if(e){b.set("header",e)}b.show()},showPage:function(b,d){a.one("#overlay").addClass("visible");this.currentHref=b;this.currentItem=d;var c=this.getLayer();c.set("content",'<div class="loading">Laden...</div>');c.set("header","");c.show({from:d});a.io(b,{method:"post",data:"ajax=1&formname="+this.formName,on:{complete:this.onGetContent},context:this});this.isVisible=true}}})();YUI.namespace.call(window,"Nb.Black5");(function(){var a=Nb.Lib;var g="move";var e="sceneChange";var f=0.01;var b=2000;var j=0;var i=0;var c=1150;var h=Nb.Black5.BackgroundController;var d=a.Easing.easeBoth;Nb.Black5.Stage=function(m,k){Nb.Black5.Stage.superclass.constructor.apply(this,arguments);this.publish(g,{emitFacade:true});this.publish(e,{emitFacade:true});this.friction=0.9;this.velocity=0;this.position=0;this.lastFrameTime=+new Date();this.scenes=m;this.scenesIdHashMap={};var p,o,n;this.currentSceneIndex=0;for(o=0,n=m.length;o<n;o++){p=m[o].id;this.scenesIdHashMap[p]=m[o];if(m[o].href===k){this.currentSceneIndex=o}}j=m[0].position;i=m[o-1].position;this.visibleScenes={};this.currentScene=m[this.currentSceneIndex];this.position=this.currentScene.position;this.container=a.one("#container")};a.extend(Nb.Black5.Stage,Nb.Black5.Model,{checkBounds:function(k){var l=this.getNextScene(),m=this.getPrevScene();this.checkSceneBounds(l);this.checkSceneBounds(m);if(l&&l.position<=k){this.hideScene(m);this.currentScene=l;this.currentSceneIndex++;this.fire(e,{scene:this.currentScene})}else{if(m&&m.position>=k){this.hideScene(l);this.currentScene=m;this.currentSceneIndex--;this.fire(e,{scene:this.currentScene})}}},checkSceneBounds:function(l){if(!l){return}var k=l.isVisible(this);if(l.status===0&&k){this.showScene(l)}else{if(l.status==2&&!k){this.hideScene(l)}}},checkStageBounds:function(k,l){if(k<j){l+=(j-k)}else{if(k>i){l+=i-k}}return l},getMovePosition:function(l,k){var m=l-this.scrollToSceneStartTime;if(m>b){k=this.scrollToScene.position;this.scrollToScene=null}else{k=d(m,this.scrollToSceneStart,this.scrollToSceneDelta,b)}return k},getNextScene:function(){return(this.currentSceneIndex>this.scenes.length-1)?null:this.scenes[this.currentSceneIndex+1]},getPrevScene:function(){return(this.currentSceneIndex===0)?null:this.scenes[this.currentSceneIndex-1]},hideScene:function(k){if(!k){return}k.destroy(this);delete this.visibleScenes[k.id]},init:function(){this.updateSize();this.fpsManager=Nb.Black5.FpsManager(this);this.fpsManager.start();this.showScene(this.currentScene);this.checkBounds(this.position);h.position(this.position);this.fire(e,{scene:this.currentScene})},onFrame:function(q){var n=+new Date(),p=(n-this.lastFrameTime)/1000;this.lastFrameTime=n;this.fpsManager.add(p);this.velocity*=this.friction;if(this.velocity<f&&this.velocity>-f){this.velocity=0}var m=this.velocity,k=this.position,o=this.scrollToScene;m=this.checkStageBounds(k,m);if(!o&&m===0){return}if(o){k=this.getMovePosition(n,k)}else{k+=m*p}this.redraw(k);var l=this.currentScene;if(l.background){h.position(k,l.background)}this.checkBounds(k);this.fire(g,{position:this.position})},redraw:function(l){this.position=l;var k=this.visibleScenes,n;for(var m in k){n=k[m];this.setSceneOffset(n,l);n.positionElements(this)}},setSceneByHref:function(l){if(this.scrollToScene){return true}var k=this.scenes,n=k.length;for(var m=0;m<n;m++){if(k[m].href==l){this.scrollToScene=k[m];document.title=this.scrollToScene.title;this.scrollToSceneStart=this.position;this.scrollToSceneStartTime=+new Date();this.scrollToSceneDelta=k[m].position-this.position;if(this.scrollToScene.sound){a.later(b-this.scrollToScene.soundDelay,this.scrollToScene.sound,this.scrollToScene.sound.play)}return true}}return false},setSceneOffset:function(l,k){l.offset=(l.position-k)/l.width},showScene:function(k){var l=+new Date();this.visibleScenes[k.id]=k;k.render(this);this.setSceneOffset(k,this.position);k.positionElements(this)},updateVelocity:function(k){this.velocity+=k},updateSize:function(){this.width=a.DOM.winWidth();this.height=a.DOM.winHeight();var k=this.width<c;if(k!=this.isCompactMode){this.isCompactMode=k;var l=k?"addClass":"removeClass";a.one(document.body)[l]("compact-mode")}}});a.augment(Nb.Black5.Stage,a.EventTarget)}());YUI.namespace.call(window,"Nb.Black5");(function(){var b=Nb.Lib;var a=100;Nb.Black5.Scene=function(c){Nb.Black5.Scene.superclass.constructor.apply(this,arguments);this.offset=0;this.status=0;var e=[];this.config=c;for(var d=0;d<c.elements.length;d++){if(!c.elements[d].screen){e.push(this.createElement(c.elements[d]))}}this.elements=e;this.currentScreen=null;if(this.sound){this.sound=new Nb.Black5.Sound(this.sound)}};b.extend(Nb.Black5.Scene,Nb.Black5.Model,{addElementCfg:function(e){var c=this.config,d;for(d=0;d<c.elements.length;d++){if(c.elements[d].id==e.id){return}}c.elements.push(e)},createElement:function(c){var d=c.type;return Nb.Core.Util.createInstance(d,c)},destroy:function(){var e=this.elements,c,d;for(c=0,d=e.length;c<d;c++){e[c].destroy()}this.status=0},getElementById:function(f){var c=0,d=this.elements.length,e=this.elements;for(;c<d;c++){if(e[c].id==f){return e[c]}}return null},isVisible:function(d){var f=this.position;var e=f>d.position-a&&f<d.position+d.width/2+a;if(e){return true}f+=this.width;var c=f>d.position-a&&f>d.position+a;if(c){return true}return e||c},positionElements:function(c){var f=this.elements,d,e;for(d=0,e=f.length;d<e;d++){f[d].position(c,this)}},render:function(c){this.stage=c;var f=this.elements,d,e;for(d=0,e=f.length;d<e;d++){f[d].render(c.container)}this.status=2},setScreen:function(d){var f=0,h=this.elements.length,g,e,c=this.status==2;for(f=h-1;f>=0;f--){if(this.elements[f].screen&&this.elements[f].screen!=d){this.elements.splice(f,1)[0].destroy()}}e=this.config;for(f=0;f<e.elements.length;f++){if(e.elements[f].screen==d){g=this.createElement(e.elements[f]);this.elements.push(g);if(c){g.render(this.stage.container)}}}if(c){this.positionElements(this.stage)}},toString:function(){return this.id}})}());(function(){var b=Nb.Lib;var a=b.Easing.easeNone;Nb.Black5.Element=function(){Nb.Black5.Element.superclass.constructor.apply(this,arguments);this.rawElement=b.DOM.create(this.html),this.element=b.one(this.rawElement),this.boost=1+this.layer/10,this.height=this.height||null,this.element.setStyles({position:"absolute",left:-2000,top:-2000,zIndex:this.layer*10});if(this.href){this.rawLinkElement=b.DOM.create('<a href="'+this.href+'" class="link-element"></a>');this.hrefElement=b.one(this.rawLinkElement);this.hrefElement.setStyles({height:this.height+"px",position:"absolute",left:-2000,top:-2000,width:this.width+"px",zIndex:this.layer*100});this.hrefElement.on("click",function(c){c.halt();if(c.target.get("href").indexOf(document.location.host)==-1){window.open(c.target.get("href"),"_blank")}else{Nb.App.navigation.setActive(this.href,true)}},this)}};b.extend(Nb.Black5.Element,Nb.Black5.Model,{destroy:function(){this.element.removeClass("element-visible");if(this.timer){this.timer.cancel()}var c=Nb.Lib.UA.ie>0&&Nb.Lib.UA.ie<9?0:1000;this.timer=b.later(c,this.element,this.element.remove);if(this.href){this.hrefElement.remove()}},getHeight:function(){if(this.height===null){this.height=this.rawElement.offsetHeight}return this.height},getPosition:function(e,d,c){return a(c,e,d-e,1)},getWidth:function(){if(!this.width){this.width=this.rawElement.offsetWidth}return this.width},getX:function(c,e,f,d){return -c.position+e.position+f+e.width*e.offset*d},getY:function(d,f,e,c){return(d.height-c-f.height)/2+e},position:function(h,g){var c=h.isCompactMode,j=this.getX(h,g,(c?this.compactX:this.x),this.layer),i=this.getY(h,g,(c?this.compactY:this.y),this.getHeight());if(c){j-=256}if(this.rotate){var f=this.rotate,e=g.offset>0?1-g.offset:-g.offset,l=g.offset>0?f.from:0,k=g.offset>0?0:f.to,d=this.getPosition(l,k,e);b.DOM.setStyle(this.rawElement,"transform","rotate("+d+"deg)")}this.setPos(j,i)},render:function(c){c.appendChild(this.element);if(this.timer){this.timer.cancel()}this.timer=b.later(50,this.element,this.element.addClass,"element-visible");if(this.href){c.appendChild(this.hrefElement)}},setPos:function(c,e){var d=this.rawElement.style;d.left=c+"px";d.top=e+"px";if(this.href){d=this.rawLinkElement.style;d.left=c+"px";d.top=e+"px"}}})}());(function(){var a=Nb.Lib;Nb.Black5.Layer=function(b){Nb.Black5.Layer.superclass.constructor.apply(this,arguments)};Nb.Black5.Layer.NAME="Nb.Black5.Layer";Nb.Black5.Layer.ATTRS={contentUrl:{value:null}};a.extend(Nb.Black5.Layer,Nb.Core.UI.Layer,{getHtml:function(){return['<div class="layer">','<div class="layer-headline"></div>','<div class="layer-body-content"></div>','<div class="layer-close"></div>',"</div>"].join("")}})})();Nb.Black5.SoundManager=function(){Y=Nb.Lib;var a=this;Y.on("load",function(){a.element=typeof swfobject!="undefined"?swfobject.getObjectById("sound"):Y.DOM.byId("sound");if(!a.element){return}var b=Nb.Core.Cookie.get("soundoff");a.isSoundOff=b===null||Nb.Core.Cookie.get("soundoff")=="1";a.button=Y.one("#nav-top-sound");a.button.on("click",function(){a.isSoundOff=!a.isSoundOff;if(a.isSoundOff){a.stop()}else{a.play()}},a);if(!a.isSoundOff){a.play()}},window)};Nb.Black5.SoundManager.prototype={play:function(){if(typeof swfobject!="undefined"){this.element.playSound()}else{this.element.play()}this.button.addClass("on");Nb.Core.Cookie.set("soundoff","0",3600*24*30)},stop:function(){if(typeof swfobject!="undefined"){this.element.stopSound()}else{this.element.pause()}this.button.removeClass("on");Nb.Core.Cookie.set("soundoff","1",3600*24*30)}};Nb.Black5.Sound=function(d){Y=Nb.Lib;this.id=d.replace(/[^a-z]/ig,"")+Math.round(Math.random()*1000);if(typeof swfobject!="undefined"){var a={mp3:"/asset/common/mp3/"+d+".mp3?rnd="+Math.random()};var e={allowscriptaccess:"always",id:this.id,wmode:"transparent"};this.isLoop=false;var b={};var f=document.createElement("div");f.id=this.id;document.body.appendChild(f);swfobject.embedSWF("/asset/flash-sound/swf/sound-click.swf?rnd="+Math.random(),this.id,"1","1","10.0.24","http://fpdownload.macromedia.com/pub/flashplayer/update/current/swf/autoUpdater.swf",a,e,b)}else{var c=['<audio id="'+this.id+'">','<source src="/asset/common/mp3/'+d+'.ogg" type="audio/ogg" />','<source src="/asset/common/mp3/'+d+'.mp3" type="audio/mp3" />',"</audio>"];Y.one(document.body).append(c.join(""))}};Nb.Black5.Sound.prototype={getElement:function(){return this.isHtml5()?Y.DOM.byId(this.id):swfobject.getObjectById(this.id)},isHtml5:function(){return typeof swfobject=="undefined"},loopHtml5Sound:function(b){var a=Y.Node.getDOMNode(b.target);a.currentTime=0;a.pause();a.play()},setLoop:function(a){this.isLoop=a;if(this.isHtml5()&&a){this.getElement().addEventListener("ended",function(){this.currentTime=0;this.play()},false)}},play:function(){if(this.isHtml5()){this.getElement().play()}else{this.getElement().playSound(this.isLoop)}},stop:function(){if(this.isHtml5()){this.getElement().pause()}else{this.getElement().stopSound()}}};(function(){var b=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.General");var a=Nb.Lib.UA.ie>8||Nb.Lib.UA.ie===0;Nb.Black5.Scene.General.DotsElement=function(){this.superclass=Nb.Black5.Scene.General.DotsElement.superclass;this.superclass.constructor.apply(this,arguments);this.oldOpacity=1};b.extend(Nb.Black5.Scene.General.DotsElement,Nb.Black5.Element,{position:function(e,g){var f=1;if(a){var h=Math.abs(g.offset),d=h<0.2?1:h>0.3?0:(0.3-h)*10;if(this.oldOpacity!=d){this.rawElement.style.opacity=d;this.oldOpacity=d}}else{f=Math.abs(g.offset)<0.35?1:1.5}var c=-e.position+g.position+this.x+g.width*g.offset*f,i=(e.height-this.getHeight()-g.height)/2+this.y;this.setPos(c,i)}})}());(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.General");Nb.Black5.Scene.General.SlideNavElement=function(){this.superclass=Nb.Black5.Scene.General.SlideNavElement.superclass;this.superclass.constructor.apply(this,arguments);this.element.all("a").on("click",this.onClick,this)};a.extend(Nb.Black5.Scene.General.SlideNavElement,Nb.Black5.Element,{onClick:function(c){c.halt();var b=c.currentTarget.get("href").match(/http:\/\/[^/]+(.*)$/i)[1];Nb.App.navigation.setActive(b,true)},render:function(e){this.superclass.render.call(this,e);var c=this.element.one(".slide-nav-ul"),d=c.get("offsetWidth"),b=this.rawElement.offsetWidth,f=Math.round((b-d)/2);c.setStyle("left",f+"px")}})}());(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.General");Nb.Black5.Scene.General.ScrollableText=function(){this.superclass=Nb.Black5.Scene.General.ScrollableText.superclass;this.superclass.constructor.apply(this,arguments);this.element.setStyles({height:this.height+"px",overflow:"hidden"});this.element.on("mouseover",this.onMouseEnter,this);this.element.on("mouseout",this.onMouseLeave,this);this.scrollerY=0;this.onTop=false;this.rawElement.innerHTML='<div class="scrollbody">'+this.rawElement.innerHTML+"</div>";this.scrollBody=this.element.one(".scrollbody");var b=a.one(a.DOM.create(['<div class="scrollbar">','<div class="scroller">','<div class="scroller-top"></div>','<div class="scroller-bottom"></div>',"</div>","</div>"].join("")));this.element.appendChild(b);b.setStyle("height",this.height+"px");a.on("mousewheel",this.onMouseWheel,this)};a.extend(Nb.Black5.Scene.General.ScrollableText,Nb.Black5.Element,{destroy:function(){this.dd.destroy();this.superclass.destroy.apply(this,arguments)},onDrag:function(b){var c=b.info.xy[1]-this.scrollerStartY;this.updateScroll(c,false)},onMouseEnter:function(b){Nb.App.allowScroll=false},onMouseLeave:function(b){Nb.App.allowScroll=true},onMouseWheel:function(b){if(Nb.App.allowScroll){return}if(b.wheelDelta>0){this.updateScroll(this.scrollerY-2,true)}else{this.updateScroll(this.scrollerY+2,true)}},position:function(b,c){this.superclass.position.apply(this,arguments);if(c.offset<0.07&&!this.onTop){this.onTop=true;this.element.setStyle("zIndex",400)}else{if(c.offset>0.07&&this.onTop){this.onTop=false;this.element.setStyle("zIndex",this.layer*10)}}this.scrollerStartY=this.scroller.getY()},render:function(){this.superclass.render.apply(this,arguments);this.bodyHeight=this.element.one(".scrollbody").get("offsetHeight");var b=this.element.one(".scroller");this.scrollerHeight=Math.round(this.height*this.height/this.bodyHeight);b.setStyle("height",this.scrollerHeight+"px");this.scroller=b;this.dd=new a.DD.Drag({node:b}).plug(a.Plugin.DDConstrained,{constrain:b.get("parentNode")});this.dd.on("drag",this.onDrag,this)},updateScroll:function(d,b){var c=-Math.round(d/(this.height-this.scrollerHeight)*(this.bodyHeight-this.height));this.scrollerY=Math.max(0,Math.min(d,(this.height-this.scrollerHeight)));this.scrollBody.setStyle("top",c+"px");if(b){this.scroller.setStyle("top",d+"px")}}})}());(function(){var b=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.Start");var a=Nb.Lib.UA.ie>8||Nb.Lib.UA.ie===0;Nb.Black5.Scene.Start.Black5Element=function(){this.superclass=Nb.Black5.Scene.Start.Black5Element.superclass;this.superclass.constructor.apply(this,arguments);this.element.setStyle("zIndex",400);this.updatePosition();b.on("resize",this.onResize,window,this)};b.extend(Nb.Black5.Scene.Start.Black5Element,Nb.Black5.Element,{onResize:function(){this.updatePosition()},position:function(f,h){var g=1,i=Math.abs(h.offset);if(a){var e=i<0.05?1:i>0.15?0:(0.15-i)*10;if(this.oldOpacity!=e){this.rawElement.style.opacity=e;this.oldOpacity=e}}else{var d=i<0.15?"visible":"hidden";this.rawElement.style.visibility=d}var c=this.getX(f,h,(f.isCompactMode?this.compactX:this.x),g),j=this.y;this.setPos(c,j)},updatePosition:function(){this.x=b.DOM.winWidth()-350;this.compactX=this.x+110;this.y=b.DOM.winHeight()-290}})}());(function(){var f=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.Black5");var d=0.15;var c={top:{left:-83,top:-155},middle:{left:-15,top:-39}};var a={top:{left:-36,top:-54},middle:{left:0,top:0}};var e={top:{left:c.top.left-a.top.left,top:c.top.top-a.top.top},middle:{left:c.middle.left-a.middle.left,top:c.middle.top-a.middle.top}};var b=f.Easing.easeOut;Nb.Black5.Scene.Black5.CookieElement=function(){this.superclass=Nb.Black5.Scene.Black5.CookieElement.superclass;this.superclass.constructor.apply(this,arguments);this.top=f.Node.getDOMNode(this.element.one("#black5-as-cookie-top"));this.middle=f.Node.getDOMNode(this.element.one("#black5-as-cookie-middle"))};f.extend(Nb.Black5.Scene.Black5.CookieElement,Nb.Black5.Element,{getPosition:function(i,h){var g={};g.left=b(h,a[i].left,e[i].left,d);g.top=b(h,a[i].top,e[i].top,d);return g},position:function(j,n){this.superclass.position.call(this,j,n);var g=c;if(n.offset>=d){g=a}else{if(n.offset>0){var m=d-n.offset,g={top:this.getPosition("top",m),middle:this.getPosition("middle",m)}}}var h=g.top,k=g.middle,l=this.top,i=this.middle;l.style.left=h.left+"px",l.style.top=h.top+"px",i.style.left=k.left+"px",i.style.top=k.top+"px"}})}());(function(){var h=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.Black5");var e=0.25;var c=[0,64,130,193,257];var a=[700,900,1100,1600,2100];var g=[];var f=c.length,d;for(d=0;d<f;d++){g[d]=c[d]-a[d]}var b=h.Easing.easeOut;Nb.Black5.Scene.Black5.CookieSetElement=function(){this.superclass=Nb.Black5.Scene.Black5.CookieSetElement.superclass;this.superclass.constructor.apply(this,arguments);this.cookies=h.NodeList.getDOMNodes(this.element.all(".cookie"))};h.extend(Nb.Black5.Scene.Black5.CookieSetElement,Nb.Black5.Element,{getPositions:function(j){var i=[];for(d=0;d<f;d++){i[d]=b(j,a[d],g[d],e)}return i},position:function(j,l){this.superclass.position.call(this,j,l);var i=c;if(l.offset>=e){i=a}else{if(l.offset>0){var k=e-l.offset;i=this.getPositions(k)}}for(d=0;d<f;d++){this.cookies[d].style.bottom=i[d]+"px"}}})}());(function(){var b=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.Black5");var a=240;Nb.Black5.Scene.Black5.RotatingCookieElement=function(){this.superclass=Nb.Black5.Scene.Black5.RotatingCookieElement.superclass;this.superclass.constructor.apply(this,arguments)};b.extend(Nb.Black5.Scene.Black5.RotatingCookieElement,Nb.Black5.Element,{position:function(d,f){var c=this.getX(d,f,this.x,this.layer),g=this.getY(d,f,this.y,this.getHeight()),e=-360*(this.x-c)/Math.PI/a;this.element.setStyle("transform","rotate("+Math.round(e)+"deg)");this.setPos(c,g)}})}());(function(){var f=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.FiveWays");var d=0.4;var c={left:{left:-373,top:-10},right:{left:195,top:-10}};var a={left:{left:-340,top:0},right:{left:130,top:-32}};var b=f.Easing.easeBoth;var e={left:{left:c.left.left-a.left.left,top:c.left.top-a.left.top},right:{left:c.right.left-a.right.left,top:c.right.top-a.right.top}};Nb.Black5.Scene.FiveWays.RotateHandsElement=function(){this.superclass=Nb.Black5.Scene.FiveWays.RotateHandsElement.superclass;this.superclass.constructor.apply(this,arguments);this.left=this.element.one(".hand-left");this.right=this.element.one(".hand-right")};f.extend(Nb.Black5.Scene.FiveWays.RotateHandsElement,Nb.Black5.Element,{getPosition:function(h,i){var g={};g.left=b(i,a[h].left,e[h].left,d);g.top=b(i,a[h].top,e[h].top,d);return g},position:function(h,j){this.superclass.position.call(this,h,j);var g=c;if(j.offset>=d){g=a}else{if(j.offset>0){var i=d-j.offset;g.left=this.getPosition("left",i);g.right=this.getPosition("right",i)}}this.left.setStyles(g.left);this.right.setStyles(g.right)}})}());(function(){var f=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.FiveWays");var d=0.4;var c={left:{left:-352,top:189},right:{left:178,top:200}};var a={left:{left:-312,top:208},right:{left:163,top:197}};var b=f.Easing.easeBoth;var e={left:{left:c.left.left-a.left.left,top:c.left.top-a.left.top},right:{left:c.right.left-a.right.left,top:c.right.top-a.right.top}};Nb.Black5.Scene.FiveWays.HalveHandsElement=function(){this.superclass=Nb.Black5.Scene.FiveWays.HalveHandsElement.superclass;this.superclass.constructor.apply(this,arguments);this.left=this.element.one(".hand-left");this.right=this.element.one(".hand-right")};f.extend(Nb.Black5.Scene.FiveWays.HalveHandsElement,Nb.Black5.Element,{getPosition:function(h,i){var g={};g.left=b(i,a[h].left,e[h].left,d);g.top=b(i,a[h].top,e[h].top,d);return g},position:function(h,j){this.superclass.position.call(this,h,j);var g=c;if(j.offset>=d){g=a}else{if(j.offset>0){var i=d-j.offset;g.left=this.getPosition("left",i);g.right=this.getPosition("right",i)}}this.left.setStyles(g.left);this.right.setStyles(g.right)}})}());(function(){var h=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.TopQuality");var a=[[0,363],[0,363],[0,363],[0,363],[0,363]];var g=[[507,0],[381,90],[253,182],[128,272],[0,363]];var c=[[507,0],[507,0],[507,0],[507,0],[507,0]];var f=c.length,e;var d=0.5;var b=h.Easing.easeOut;Nb.Black5.Scene.TopQuality.CookieSetElement=function(){this.superclass=Nb.Black5.Scene.TopQuality.CookieSetElement.superclass;this.superclass.constructor.apply(this,arguments);this.cookies=h.NodeList.getDOMNodes(this.element.all(".cookie"))};h.extend(Nb.Black5.Scene.TopQuality.CookieSetElement,Nb.Black5.Element,{getPositions:function(j,l,k){var i=[];for(e=0;e<f;e++){i[e]=[b(j,l[e][0],k[e][0]-l[e][0],d),b(j,l[e][1],k[e][1]-l[e][1],d)]}return i},position:function(j,l){this.superclass.position.call(this,j,l);var n=a,m,k=0,i;if(l.offset>=0.5&&l.offset<1){m=g;k=1-l.offset}else{if(l.offset>0&&l.offset<0.5){n=g;m=c;k=0.5-l.offset}else{n=m=l.offset<=0?c:a}}if(n!=m){i=this.getPositions(k,n,m)}else{i=n}if(this.lastPositions!=i){for(e=0;e<f;e++){this.cookies[e].style.left=i[e][0]+"px";this.cookies[e].style.top=i[e][1]+"px"}}this.lastPosition=i}})}());(function(){var h=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.TopQuality");var g=[6,8,7,3,4,4.5,9,10,2,1,1.5];var a=[[-210,46,20,0.95],[-27,178,-20,0.9],[-16,169,-10,0.7],[-3,307,-180,0.4],[22,370,180,0.8],[10,190,0,0.8],[-2,-44,-20,0.7],[-120,353,30,0.1],[242,183,90,0.8],[264,433,-90,0.4],[238,398,-50,0.5]];var c=[[-230,46,0,1],[72,218,0,1],[112,58,0,1],[56,307,0,1],[100,362,0,1],[121,161,0,1],[179,-199,0,1],[-160,463,0,1],[333,142,0,1],[362,450,0,1],[344,425,0,1]];var f=c.length,e;var d=0.5;var b=h.Easing.easeOut;Nb.Black5.Scene.TopQuality.ExplodingCookie=function(){this.superclass=Nb.Black5.Scene.TopQuality.ExplodingCookie.superclass;this.superclass.constructor.apply(this,arguments);this.cookies=h.NodeList.getDOMNodes(this.element.all(".cookie"));for(var j=0;j<f;j++){this.cookies[j].style.zIndex=g[j]*10}};h.extend(Nb.Black5.Scene.TopQuality.ExplodingCookie,Nb.Black5.Element,{getPositions:function(j,l,k){var i=[];for(e=0;e<f;e++){i[e]=[b(j,l[e][0],k[e][0]-l[e][0],d),b(j,l[e][1],k[e][1]-l[e][1],d),b(j,l[e][2],k[e][2]-l[e][2],d),b(j,l[e][3],k[e][3]-l[e][3],d)]}return i},position:function(k,m){this.superclass.position.call(this,k,m);var j;if(m.offset>d){j=a}else{if(m.offset>0&&m.offset<=d){j=this.getPositions(d-m.offset,a,c)}else{j=c}}for(var l=0;l<f;l++){this.cookies[l].style.left=Math.round(j[l][0])+"px";this.cookies[l].style.top=Math.round(j[l][1])+"px";if(!h.UA.webkit||h.UA.webkit>=535){h.DOM.setStyle(this.cookies[l],"transform","rotate("+j[l][2]+"deg) scale("+j[l][3]+")")}}}})}());(function(){var b=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.TopQuality");var a=Nb.Lib.UA.ie>8||Nb.Lib.UA.ie===0;Nb.Black5.Scene.TopQuality.Background=function(){this.superclass=Nb.Black5.Scene.TopQuality.Background.superclass;this.superclass.constructor.apply(this,arguments);this.oldOpacity=1};b.extend(Nb.Black5.Scene.TopQuality.Background,Nb.Black5.Element,{position:function(e,g){var f=1;var h=g.offset,d=0;if(a){if(h>0.5){d=0}else{if(h<0.5&&h>=0){d=1-h*2}else{if(h<0&&h>-0.1){d=1}else{if(h<-0.1&&h>-0.3){d=1-(Math.abs(h)-0.1)/0.2}else{d=0}}}}if(this.oldOpacity!=d){this.rawElement.style.opacity=d;this.oldOpacity=d}}else{if(h>=0.4){f=1+(h-0.4)*2/0.4}}var c=-e.position+g.position+this.x+g.width*g.offset*f,i=0;this.setPos(c,i)}})}());(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.Sweepstake");Nb.Black5.Scene.Sweepstake.MainScene=function(){this.superclass=Nb.Black5.Scene.Sweepstake.MainScene.superclass;this.superclass.constructor.apply(this,arguments);this.slotMachine=this.getElementById("sweepstake-main-slotmachine");this.slotMachine.on("codeSuccess",this.updateState,this);this.slotMachine.on("codeFailure",this.updateState,this);this.slotMachine.on("roll",this.onRoll,this);this.slotMachine.on("stop",this.onStopRoll,this);this.wonSound=new Nb.Black5.Sound("sweepstake/win/win");this.lostSound=new Nb.Black5.Sound("sweepstake/lose/lose");this.setScreen("start")};a.extend(Nb.Black5.Scene.Sweepstake.MainScene,Nb.Black5.Scene,{onLotteryResult:function(k,c){try{var b=a.JSON.parse(c.responseText),h=b.elements,g=h.length,f=0;this.slotMachine.stopRoll(b.combination);for(;f<g;f++){this.addElementCfg(h[f])}this.nextScreen=b.screen}catch(j){var d=this.getRandomCombination();this.slotMachine.stopRoll(d);this.nextScreen="lost"}},getRandomCombination:function(){var b=[0,0,0,0,0],c;while(b[0]==b[4]){for(c=0;c<5;c++){b[c]=1+Math.round(Math.random()*2)}}return b},onRoll:function(){this.setScreen("roll");var b={code:this.slotMachine.getCode(),form:this.form.getData()};Nb.Black5.EncryptedXhr.send("/sweepstake/send-code",b,this.onLotteryResult,this)},onStopRoll:function(){this.setScreen(this.nextScreen)},onTryAgain:function(){this.slotMachine.newCoin();this.setScreen("start")},onWinFormNextClick:function(){this.setScreen("won-form")},setScreen:function(b){this.superclass.setScreen.call(this,b);switch(b){case"start":this.form=this.getElementById("sweepstake-main-form");this.form.on("valid",this.updateState,this);this.form.on("invalid",this.updateState,this);this.updateState();break;case"lost":a.later(500,this.lostSound,this.lostSound.play);this.getElementById("sweepstake-main-lost-try-again").element.on("click",this.onTryAgain,this);break;case"won-start":this.wonSound.play();this.getElementById("sweepstake-main-won-btn").element.on("click",this.onWinFormNextClick,this);break;case"won-form":this.registrationForm=this.getElementById("sweepstake-won-form");a.one("#sweepstake-main-won-form-btn").on("click",this.onRegister,this);break}},updateState:function(){var c=this.slotMachine.isCodeOkay?"removeClass":"addClass",e=this.form.isValid?"removeClass":"addClass",d=this.getElementById("sweepstake-main-form"),b=this.getElementById("sweepstake-main-step3");d.element[c]("disabled");b.element[e]("disabled");if(this.slotMachine.isCodeOkay&&this.form.isValid){this.slotMachine.insertCoin()}},onRegister:function(d){var b=a.one("#sweepstake-main-won-form-btn");if(b.hasClass("disabled")){return}this.registrationForm=this.getElementById("sweepstake-main-won-form-form");if(this.registrationForm.validate(d)){var c={code:this.slotMachine.getCode(),form:this.registrationForm.getData()};b.addClass("disabled");Nb.Black5.EncryptedXhr.send("/sweepstake/save-participant",c,this.onRegisterResult,this)}},onRegisterResult:function(d,c){var b=a.JSON.parse(c.responseText);if(b.success){this.setScreen("thankyou")}else{alert("Error: ...")}}})}());(function(){var d=Nb.Lib;var a="codeSuccess",b="codeFailure",c="stop";YUI.namespace.call(window,"Nb.Black5.Scene.Sweepstake");Nb.Black5.Scene.Sweepstake.SlotMachine=function(){this.superclass=Nb.Black5.Scene.Sweepstake.SlotMachine.superclass;this.superclass.constructor.apply(this,arguments);this.isCodeOkay=false;this.rotateSound=new Nb.Black5.Sound("sweepstake/rotate/rotate");this.rotateSound.setLoop(true);this.insertCoinSound=new Nb.Black5.Sound("sweepstake/insertcoin/insertcoin");this.codeInput=this.element.one("#code-input");this.codeInput.on("keydown",this.onKeyDown,this);this.codeInput.on("keyup",this.onKeyUp,this);this.codeInput.on("focus",this.onFocus,this);this.slotMachineEl=this.element.one(".slotmachine");var f=this.element.one(".lever");var e=this.element.one(".lever-drag");this.lever=new Nb.Black5.Scene.Sweepstake.Lever(f,e);this.lever.on("roll",this.roll,this);this.slots=[];this.element.all(".slot").each(function(g){this.slots.push(new Nb.Black5.Scene.Sweepstake.Slot(g))},this);this.slots[4].on("stop",this.onLastSlotStop,this);this.cookieEl=this.element.one(".coin-cookie");this.cookieAnimIn=new d.Anim({node:this.cookieEl,to:{top:19},duration:0.5,easing:d.Easing.easeIn});this.cookieAnimOut=new d.Anim({node:this.cookieEl,to:{top:-101},duration:0.5,easing:d.Easing.easeOut});this.publish(a,{emitFacade:true});this.publish(b,{emitFacade:true})};d.extend(Nb.Black5.Scene.Sweepstake.SlotMachine,Nb.Black5.Element,{getCode:function(){return this.codeInput.get("value")},getToolTip:function(){if(!this._tooltip){this._tooltip=new Nb.Core.UI.ToolTip({align:"left",offsetLeft:-5,offsetTop:-10,className:"form-tooltip"});this._tooltip.render(document.body)}return this._tooltip},insertCoin:function(){this.lever.enable()},newCoin:function(){this.cookieEl.setY(-200);this.cookieEl.removeClass("in");this.cookieAnimOut.run();this.isCodeOkay=false;this.codeInput.set("value","00000000");var e=this.element.one(".form-valid-checkbox");e.removeClass("form-valid-checkbox-visible")},onCodeValidationComplete:function(i,g){if(g.status!=200){return}this.slotMachineEl.removeClass("loading");var f=d.JSON.parse(g.responseText),e=this.element.one(".form-valid-checkbox");if(f.success){e.addClass("form-valid-checkbox-visible");this.isCodeOkay=true;this.fire(a)}else{e.removeClass("form-valid-checkbox-visible");this.isCodeOkay=false;this.fire(b);var h=this.getToolTip();h.set("text",f.error);h.show(this.codeInput);if(this.tooltipTimer){this.tooltipTimer.cancel()}this.tooltipTimer=d.later(3000,h,h.hide)}},onFocus:function(f){d.Node.getDOMNode(f.target).select()},onKeyDown:function(f){f.stopPropagation()},onKeyUp:function(g){var h=g.target.get("value");if(h.length==8){this.validateCode(h)}else{var f=this.element.one(".form-valid-checkbox");f.removeClass("form-valid-checkbox-visible");this.isCodeOkay=false;this.fire(b)}},onLastSlotStop:function(){this.isRolling=false;this.lever.disable();this.fire(c);this.rotateSound.stop()},render:function(){Nb.Black5.Scene.Sweepstake.SlotMachine.superclass.render.apply(this,arguments);var e=["/asset/common/img/scene/sweepstake/main/slot/v1/cookie1.png","/asset/common/img/scene/sweepstake/main/slot/v1/cookie2.png","/asset/common/img/scene/sweepstake/main/slot/v1/cookie3.png","/asset/common/img/scene/sweepstake/main/slot/rotation.png",];this.preloaderEl=this.element.one(".image-preloader");for(var f=0;f<e.length;f++){this.preloaderEl.appendChild(d.DOM.create('<img src="'+e[f]+'" />'))}},roll:function(){if(this.isRolling){return}this.cookieEl.addClass("in");this.cookieAnimIn.run();this.insertCoinSound.play();this.rotateSound.play();this.isRolling=true;for(var e=0;e<5;e++){this.slots[e].roll(e)}this.fire("roll")},stopRoll:function(f){for(var e=0;e<5;e++){this.slots[e].stopRoll(e,f[e])}},validateCode:function(e){if(this.tooltipTimer){this.tooltipTimer.cancel()}this.getToolTip().hide();var f={code:e,l:d.one("#language").get("value")};this.slotMachineEl.addClass("loading");if(this.validateReq){this.validateReq.abort()}this.validateReq=Nb.Black5.EncryptedXhr.send("/sweepstake/validate-code",f,this.onCodeValidationComplete,this)}});d.augment(Nb.Black5.Scene.Sweepstake.SlotMachine,d.EventTarget)}());(function(){var e=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.Sweepstake");var d="stop";var b=141;var f=6;var a=25;var c=3;Nb.Black5.Scene.Sweepstake.Slot=function(g){this.element=g;this.dom=e.Node.getDOMNode(g);this.currentCookie=1;this.currentFrame=13;this.dom.style.backgroundPosition="0 -"+Number(this.currentFrame*b)+"px";this.stopSound=new Nb.Black5.Sound("sweepstake/rotate/bling")};Nb.Black5.Scene.Sweepstake.Slot.prototype.getCycleCount=function(h,j){var i=Math.floor(h/(a*this.decrement));var g=h%(a*this.decrement);if(g+j*this.decrement>=a*this.decrement){i++}return i};Nb.Black5.Scene.Sweepstake.Slot.prototype.getStartCookie=function(h,j,g){var i=this.getCycleCount(h,j);var k=g-i-2;while(k<0){k+=c}return k};Nb.Black5.Scene.Sweepstake.Slot.prototype.roll=function(g){this.element.addClass("rotating");this.currentFrame=g;this.frameCount=f;this.frameFn=e.bind(this.onFrame,this);this.reqAnimFrame=this.getReqAnimFrame();this.isRotating=true;this.isStopping=false;this.decrement=0.5;this.onFrame()};Nb.Black5.Scene.Sweepstake.Slot.prototype.getReqAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null};Nb.Black5.Scene.Sweepstake.Slot.prototype.onFrame=function(){this.dom.style.backgroundPosition="0 -"+Number(this.currentFrame*b)+"px";this.currentFrame++;if(this.currentFrame>this.frameCount){this.currentFrame=0;this.setCookie(this.currentCookie+1);if(this.rate<a&&this.resultCookie==this.currentCookie){this.currentCookie=this.resultCookie}}if(this.isStopping){this.rate-=this.decrement;if(this.resultCookie==this.currentCookie&&this.currentFrame==13&&this.rate<=20){this.stopSound.play();this.fire(d);return}else{if(this.rate<=a&&this.currentFrame>13){this.rate=Math.max(20,this.rate)}}if(this.rate==a){this.decrement=1}if(this.rate==40&&this.element.hasClass("rotating")){this.frameCount=a;this.currentFrame*=4;this.rate=70;this.element.removeClass("rotating");var g=this.getStartCookie(this.rate,this.currentFrame,this.resultCookie);this.setCookie(g)}e.later(1000/this.rate,this,this.onFrame)}else{if(this.reqAnimFrame){var h=this.reqAnimFrame;h(this.frameFn)}else{setTimeout(this.frameFn,1000/60)}}};Nb.Black5.Scene.Sweepstake.Slot.prototype.setCookie=function(g){this.element.removeClass("cookie"+this.currentCookie);this.currentCookie=g;if(this.currentCookie>c){this.currentCookie=1}this.element.addClass("cookie"+this.currentCookie)};Nb.Black5.Scene.Sweepstake.Slot.prototype.stopRoll=function(h,g){this.resultCookie=g;e.later(2000*h,this,this.stopRollInternal)};Nb.Black5.Scene.Sweepstake.Slot.prototype.stopRollInternal=function(){clearInterval(this.interval);this.rate=90;this.isStopping=true};e.augment(Nb.Black5.Scene.Sweepstake.Slot,e.EventTarget)}());(function(){var d=Nb.Lib;var b=24;var c=100;var a=259;YUI.namespace.call(window,"Nb.Black5.Scene.Sweepstake");Nb.Black5.Scene.Sweepstake.Lever=function(f,e){this.element=f;this.dom=d.Node.getDOMNode(f);this.sound=new Nb.Black5.Sound("sweepstake/lever/lever");this.dragEl=e;this.dragEl.setStyle("display","none");this.dragEl.on("mousedown",this.onMouseDown,this);this.dragEl.on("dragstart",function(g){g.preventDefault()})};Nb.Black5.Scene.Sweepstake.Lever.prototype.onMouseDown=function(f){d.one(document.body).addClass("lever-dragging");this.dragElXy=this.dragEl.getXY();this.isDragging=true;this.startY=f.pageY;this.mouseUpListener=d.on("mouseup",this.onMouseUp,document,this);this.mouseMoveListener=d.on("mousemove",this.onMouseMove,document,this);if(d.UA.ie){d.config.doc.body.onselectstart=function(){return false}}};Nb.Black5.Scene.Sweepstake.Lever.prototype.onMouseUp=function(f){this.detachDrag()};Nb.Black5.Scene.Sweepstake.Lever.prototype.onMouseMove=function(f){f.preventDefault();this.dragEl.setXY([f.pageX-20,f.pageY-20]);var h=f.pageY-this.startY;h=Math.max(0,h);h=Math.min(c,h);var g=Math.ceil(h*b/c);this.setFrame(g);if(g==24){this.sound.play();this.fire("roll")}};Nb.Black5.Scene.Sweepstake.Lever.prototype.detachDrag=function(){d.one(document.body).removeClass("lever-dragging");this.mouseUpListener.detach();this.mouseMoveListener.detach();this.dragEl.setXY(this.dragElXy);this.setFrame(0)};Nb.Black5.Scene.Sweepstake.Lever.prototype.setFrame=function(f){var e=a*f;this.dom.style.backgroundPosition="0 -"+e+"px"};Nb.Black5.Scene.Sweepstake.Lever.prototype.enable=function(){this.dragEl.setStyle("display","block");this.dragEl.setStyle("left","");this.dragEl.setStyle("top","")};Nb.Black5.Scene.Sweepstake.Lever.prototype.disable=function(){this.dragEl.setStyle("display","none");this.detachDrag()};d.augment(Nb.Black5.Scene.Sweepstake.Lever,d.EventTarget)}());(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.Sweepstake");Nb.Black5.Scene.Sweepstake.TermsLink=function(){this.superclass=Nb.Black5.Scene.Sweepstake.TermsLink.superclass;this.superclass.constructor.apply(this,arguments);this.element.on("click",this.onClick,this)};a.extend(Nb.Black5.Scene.Sweepstake.TermsLink,Nb.Black5.Element,{onClick:function(b){Nb.App.showPage("/terms.html",b.target)}})}());(function(){var c=Nb.Lib;var b="valid",a="invalid";YUI.namespace.call(window,"Nb.Black5.Scene.Sweepstake");Nb.Black5.Scene.Sweepstake.FormElement=function(){this.superclass=Nb.Black5.Scene.Sweepstake.FormElement.superclass;this.superclass.constructor.apply(this,arguments);this.formConfigKey="notdefined";this.element.all("input[type=text]").on("keyup",this.onKeyUp,this);this.element.all("input[type=text]").on("blur",this.onBlur,this);this.isValid=false};c.extend(Nb.Black5.Scene.Sweepstake.FormElement,Nb.Black5.Element,{getData:function(){return this.form.getData()},render:function(){this.superclass.render.apply(this,arguments);var f=Nb.PageConfig[this.formConfigKey];if(!f){throw new Error("Form config with key "+this.formConfigKey+" couldn't be found.")}this.form=new Nb.Core.Form(f);var e=this.form.get("controls");for(var d=0;d<e.length;d++){if(e[d] instanceof Nb.Core.UI.Control.CheckBox){e[d].after("checkedChange",this.onCheckBoxClick,this)}}},onBlur:function(g){var d=this.form.validate();if(!d.isValid){for(var f in d.errors){if(d.errors[f].fieldName==g.target.get("name")){this.form.get("errorProvider").show(this.form,[d.errors[f]])}}}this.setValid(d)},onCheckBoxClick:function(d){this.setValid(this.form.validate())},onKeyUp:function(d){this.setValid(this.form.validate())},setValid:function(d){var e=this.element.one(".form-valid-checkbox");if(d.isValid){e.addClass("form-valid-checkbox-visible");this.isValid=true;this.fire(b)}else{e.removeClass("form-valid-checkbox-visible");this.isValid=false;this.fire(a)}},validate:function(f){var d=this.form.validate();if(!d.isValid){this.form.get("errorProvider").show(this.form,[d.errors[0]])}this.setValid(d);return this.isValid}});c.augment(Nb.Black5.Scene.Sweepstake.FormElement,c.EventTarget)}());(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.Sweepstake");Nb.Black5.Scene.Sweepstake.StartForm=function(){this.superclass=Nb.Black5.Scene.Sweepstake.StartForm.superclass;this.superclass.constructor.apply(this,arguments);this.formConfigKey="sweepstakeStart"};a.extend(Nb.Black5.Scene.Sweepstake.StartForm,Nb.Black5.Scene.Sweepstake.FormElement)}());(function(){var a=Nb.Lib;YUI.namespace.call(window,"Nb.Black5.Scene.Sweepstake");Nb.Black5.Scene.Sweepstake.RegistrationForm=function(){this.superclass=Nb.Black5.Scene.Sweepstake.RegistrationForm.superclass;this.superclass.constructor.apply(this,arguments);this.formConfigKey="sweepstakeRegistration"};a.extend(Nb.Black5.Scene.Sweepstake.RegistrationForm,Nb.Black5.Scene.Sweepstake.FormElement,{onTermsClick:function(b){Nb.App.showPage("/terms.html",b.target)},render:function(){Nb.Black5.Scene.Sweepstake.FormElement.prototype.render.apply(this,arguments);a.one("#sweepstake-terms-show").on("click",this.onTermsClick,this)}})}());(function(){var e=Nb.Lib;var a=Nb.Black5;var c=100;function d(){var h=Nb.PageConfig.st,f=0,g="";for(;f<h.length;f++){g+=String.fromCharCode(h[f]+f)}Nb.Black5.EncryptedXhr.st=g}Nb.Black5.Controller=function(){var i=+new Date();this.position=0;this.totalWidth=0;this.allowScroll=true;e.on("keydown",this.onKeyDown,document,this);e.on("mousewheel",this.onMouseWheel,this);e.on("resize",this.onResize,window,this);this.initHistory();var g=this.initScenes(Nb.PageConfig.scenes);Nb.Black5.BackgroundController.items=Nb.PageConfig.backgrounds;var f=this.history&&this.history.get("href")?this.history.get("href"):Nb.PageConfig.href;this.stage=new a.Stage(g,f);this.navigation=new a.Navigation();this.navigation.on("select",this.onNavigation,this);this.metaNavigation=new a.MetaNavigation();this.stage.init();this.stage.on("sceneChange",this.onSceneChange,this);this.navigation.markActive(f);if(Nb.PageConfig.isMetaPage){this.showPage(f,this.navigation.activeItem)}this.soundManager=new Nb.Black5.SoundManager();if(!f.match(/black5/)){e.later(1000,this,this.showTip)}e.one("#nav-top-language").on("click",this.switchLanguage,this);var h=window.location;h=h.toString();if(h.indexOf("?")!="-1"){e.one("#nav-top-languagede").toggleClass("active",false);e.one("#nav-top-languageuk").toggleClass("active",true)}this.updateLanguageBarVisibility(f);d();b()};Nb.Black5.Controller.prototype={initHistory:function(){try{this.history=new e.History();this.history.on("change",this.onHistoryChange,this)}catch(f){this.history=null}},initScenes:function(g){var f=[],m,k,h,j;for(k=0,h=g.length;k<h;k++){j=g[k].type?Nb.Core.Util.getType(g[k].type):a.Scene;m=new j(g[k]),f.push(m)}this.totalWidth=m.position+m.width;return f},left:function(){this.stage.updateVelocity(-c)},onHistoryChange:function(g){if(g.newVal.href){var f=g.changed.href.newVal;if(g.src=="popstate"){this.showPage(f);this.navigation.markActive(f)}}},onKeyDown:function(h){if(this.metaNavigation.isVisible){return}switch(h.keyCode){case Nb.Core.KeyCodes.RIGHT:this.right();break;case Nb.Core.KeyCodes.LEFT:this.left();break;case Nb.Core.KeyCodes.PAGE_UP:var g=this.stage.getPrevScene();if(g){this.navigation.setActive(g.href,true)}break;case Nb.Core.KeyCodes.PAGE_DOWN:var f=this.stage.getNextScene();if(f){this.navigation.setActive(f.href,true)}break;case Nb.Core.KeyCodes.HOME:this.navigation.setActive(this.stage.scenes[0].href,true);break;case Nb.Core.KeyCodes.END:this.navigation.setActive(this.stage.scenes[this.stage.scenes.length-1].href,true);break}},onMouseWheel:function(f){if(this.metaNavigation.isVisible||!this.allowScroll){return}if(f.wheelDelta>0){this.left()}else{this.right()}},onNavigation:function(f){if(this.history){if(f.isClick){this.showPage(f.href,f.item);this.history.addValue("href",f.href,{url:f.href})}else{this.history.replaceValue("href",f.href,{url:f.href})}}else{document.location=f.href}},onSceneChange:function(f){if(!this.stage.scrollToScene){this.navigation.setActive(f.scene.href,false)}document.title=f.scene.title;this.updateLanguageBarVisibility(f.scene.href)},onResize:function(){this.stage.updateSize();this.stage.redraw(this.stage.position)},right:function(){this.stage.updateVelocity(c)},showPage:function(f,g){if(!this.stage.setSceneByHref(f)){this.metaNavigation.showPage(f,g)}},showTip:function(){var f=e.one("#tip");f.addClass("visible");e.later(4000,this,function(){f.removeClass("visible")})},updateLanguageBarVisibility:function(g){var f=g.indexOf("gewinnspiel/code-gewinnspiel")!=-1;e.one("#nav-top-language").toggleClass("active",f)},switchLanguage:function(h){var f=h.target.get("id")=="nav-top-languageuk";e.one("#nav-top-languagede").toggleClass("active",!f);e.one("#nav-top-languageuk").toggleClass("active",f);var i=f?"?l=en":"?l=de";var g=window.location.href.replace(/\?l=[a-z]{2}/g,"");if(g.indexOf("#")!=-1){g=g.replace(/(#.*)$/,i+"$1")}else{g+=i}window.location=g},testFps:function(){var g=[],h=this;var f=setInterval(function(){h.right();g.push({position:h.stage.position,fps:h.stage.fpsManager.average(),scene:h.stage.currentScene.id});if(h.stage.position>4400){clearInterval(f)}},150)}};function b(){Nb.Black5.EncryptedXhr.mtd=Crypto.AES.encrypt}}());